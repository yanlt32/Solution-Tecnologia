<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ITIL - Abertura de Chamados - Solution Tecnologia</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-light: #8906E6; /* Roxo */
      --primary-dark: #050DEB; /* Azul */
      --secondary-light: #FF00E2; /* Rosa */
      --accent-light: #FF9F0A;
      --success-light: #30D158;
      --danger-light: #FF453A;
      --warning-light: #FF9F0A;
      --text-light: #1C1C1E;
      --text-secondary-light: #636366;
      --background-light: #F5F5F7;
      --surface-light: #FFFFFF;
      --border-light: #E5E5EA;
      --primary: #8906E6; /* Added for Chart.js compatibility */

      --primary-dark-dark: #FF00E2; /* Rosa */
      --secondary-dark: #050DEB; /* Azul */
      --accent-dark: #FF9F0A;
      --success-dark: #30D158;
      --danger-dark: #FF453A;
      --warning-dark: #FF9F0A;
      --text-dark: #FFFFFF;
      --text-secondary-dark: #A1A1A6;
      --background-dark: #121212;
      --surface-dark: #1E1E1E;
      --border-dark: #2C2C2E;

      --border-radius: 12px;
      --sidebar-width: 240px;
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', sans-serif;
    }

    body {
      background-color: var(--background-dark);
      color: var(--text-dark);
      line-height: 1.6;
      font-weight: 400;
      -webkit-font-smoothing: antialiased;
      transition: background-color 0.3s ease;
    }

    body[data-theme="light"] {
      background-color: var(--background-light);
      color: var(--text-light);
    }

    .dashboard-container {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: var(--sidebar-width);
      background: var(--surface-dark);
      color: var(--text-dark);
      padding: 0;
      transition: var(--transition);
      border-right: 1px solid var(--border-dark);
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
    }

    body[data-theme="light"] .sidebar {
      background: var(--surface-light);
      color: var(--text-light);
      border-right: 1px solid var(--border-light);
    }

    .sidebar-header {
      padding: 24px 20px;
      border-bottom: 1px solid var(--border-dark);
      text-align: center;
    }

    body[data-theme="light"] .sidebar-header {
      border-bottom: 1px solid var(--border-light);
    }

    .sidebar-header img.logo {
      width: 80px;
      height: auto;
      margin-bottom: 8px;
    }

    .sidebar-header h2 {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-size: 20px;
      font-weight: 700;
      color: var(--text-dark);
    }

    body[data-theme="light"] .sidebar-header h2 {
      color: var(--text-light);
    }

    .sidebar-header h2 i {
      color: var(--primary-dark);
      background: rgba(137, 6, 230, 0.2);
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    body[data-theme="light"] .sidebar-header h2 i {
      color: var(--primary-light);
    }

    .user-info {
      padding: 20px;
      margin-bottom: 0;
      border-bottom: 1px solid var(--border-dark);
    }

    body[data-theme="light"] .user-info {
      border-bottom: 1px solid var(--border-light);
    }

    .user-info p {
      margin-bottom: 6px;
      font-size: 14px;
      color: var(--text-secondary-dark);
    }

    body[data-theme="light"] .user-info p {
      color: var(--text-secondary-light);
    }

    .user-info .role-badge {
      display: inline-block;
      background: var(--primary-dark);
      color: var(--text-dark);
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      margin-top: 6px;
    }

    body[data-theme="light"] .user-info .role-badge {
      background: var(--primary-light);
      color: var(--text-light);
    }

    .nav-menu {
      list-style: none;
      padding: 12px;
      flex-grow: 1;
    }

    .nav-item {
      margin-bottom: 4px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 12px 14px;
      color: var(--text-secondary-dark);
      text-decoration: none;
      transition: var(--transition);
      gap: 10px;
      border-radius: var(--border-radius);
      font-size: 14px;
      font-weight: 500;
      position: relative;
    }

    body[data-theme="light"] .nav-link {
      color: var(--text-secondary-light);
    }

    .nav-link:hover {
      background: rgba(137, 6, 230, 0.1);
      color: var(--primary-dark);
    }

    body[data-theme="light"] .nav-link:hover {
      color: var(--primary-light);
    }

    .nav-link.active {
      background: rgba(137, 6, 230, 0.2);
      color: var(--primary-dark);
      font-weight: 600;
    }

    body[data-theme="light"] .nav-link.active {
      color: var(--primary-light);
    }

    .nav-link.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      height: 18px;
      width: 4px;
      background: var(--primary-dark);
      border-radius: 0 2px 2px 0;
    }

    body[data-theme="light"] .nav-link.active::before {
      background: var(--primary-light);
    }

    .nav-link i {
      width: 18px;
      text-align: center;
      font-size: 16px;
    }

    .sidebar-footer {
      padding: 12px;
      border-top: 1px solid var(--border-dark);
      font-size: 11px;
      color: var(--text-secondary-dark);
      text-align: center;
    }

    body[data-theme="light"] .sidebar-footer {
      border-top: 1px solid var(--border-light);
      color: var(--text-secondary-light);
    }

    .main-content {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
      background: var(--background-dark);
    }

    body[data-theme="light"] .main-content {
      background: var(--background-light);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-dark);
    }

    body[data-theme="light"] .header {
      border-bottom: 1px solid var(--border-light);
    }

    .header h1 {
      color: var(--text-dark);
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    body[data-theme="light"] .header h1 {
      color: var(--text-light);
    }

    .btn-group {
      display: flex;
      gap: 12px;
    }

    .back-btn {
      background: transparent;
      border: 1px solid var(--border-dark);
      color: var(--text-dark);
      padding: 10px 16px;
      border-radius: var(--border-radius);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: var(--transition);
      font-weight: 500;
      font-size: 14px;
    }

    body[data-theme="light"] .back-btn {
      border: 1px solid var(--border-light);
      color: var(--text-light);
    }

    .back-btn:hover {
      background: var(--primary-dark);
      color: var(--text-dark);
      border-color: var(--primary-dark);
    }

    body[data-theme="light"] .back-btn:hover {
      background: var(--primary-light);
      border-color: var(--primary-light);
    }

    .logout-btn {
      background: var(--danger-light);
      color: var(--text-dark);
      border: none;
      padding: 10px 16px;
      border-radius: var(--border-radius);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: var(--transition);
      font-weight: 500;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(255, 69, 58, 0.2);
    }

    body[data-theme="light"] .logout-btn {
      color: var(--text-light);
    }

    .logout-btn:hover {
      background: #D70015;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 69, 58, 0.3);
    }

    .stats-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--surface-dark);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      border: 1px solid var(--border-dark);
      transition: var(--transition);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    body[data-theme="light"] .stat-card {
      background: var(--surface-light);
      border: 1px solid var(--border-light);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }

    .stat-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
      font-size: 20px;
    }

    .stat-open .stat-icon {
      background: rgba(255, 159, 10, 0.2);
      color: var(--warning-light);
    }

    .stat-progress .stat-icon {
      background: rgba(5, 13, 235, 0.2);
      color: var(--primary-dark);
    }

    .stat-resolved .stat-icon {
      background: rgba(48, 209, 88, 0.2);
      color: var(--success-light);
    }

    .stat-total .stat-icon {
      background: rgba(137, 6, 230, 0.2);
      color: var(--primary-dark);
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 4px;
      color: var(--text-dark);
    }

    body[data-theme="light"] .stat-value {
      color: var(--text-light);
    }

    .stat-label {
      font-size: 14px;
      color: var(--text-secondary-dark);
    }

    body[data-theme="light"] .stat-label {
      color: var(--text-secondary-light);
    }

    .charts-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .chart-card {
      background: var(--surface-dark);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      border: 1px solid var(--border-dark);
      transition: var(--transition);
    }

    body[data-theme="light"] .chart-card {
      background: var(--surface-light);
      border: 1px solid var(--border-light);
    }

    .chart-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .chart-header h3 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-dark);
    }

    body[data-theme="light"] .chart-header h3 {
      color: var(--text-light);
    }

    .chart-filter {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border-dark);
      color: var(--text-dark);
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      transition: var(--transition);
    }

    body[data-theme="light"] .chart-filter {
      border: 1px solid var(--border-light);
      color: var(--text-light);
    }

    .chart-filter:hover {
      background: rgba(137, 6, 230, 0.15);
    }

    .chart-container {
      position: relative;
      height: 220px;
      width: 100%;
    }

    .form-card {
      background: var(--surface-dark);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      border: 1px solid var(--border-dark);
    }

    body[data-theme="light"] .form-card {
      background: var(--surface-light);
      border: 1px solid var(--border-light);
    }

    .form-card h2 {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 16px;
    }

    body[data-theme="light"] .form-card h2 {
      color: var(--text-light);
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary-dark);
      margin-bottom: 6px;
    }

    body[data-theme="light"] .form-group label {
      color: var(--text-secondary-light);
    }

    .form-control {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border-dark);
      border-radius: var(--border-radius);
      padding: 10px;
      color: var(--text-dark);
      font-size: 14px;
      transition: var(--transition);
    }

    body[data-theme="light"] .form-control {
      background: rgba(0, 0, 0, 0.05);
      border: 1px solid var(--border-light);
      color: var(--text-light);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-dark);
      box-shadow: 0 0 0 3px rgba(137, 6, 230, 0.2);
    }

    body[data-theme="light"] .form-control:focus {
      border-color: var(--primary-light);
      box-shadow: 0 0 0 3px rgba(137, 6, 230, 0.2);
    }

    .btn-primary {
      background: var(--primary-dark);
      color: var(--text-dark);
      border: none;
      padding: 12px 16px;
      border-radius: var(--border-radius);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: var(--transition);
      font-weight: 500;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(137, 6, 230, 0.2);
    }

    body[data-theme="light"] .btn-primary {
      background: var(--primary-light);
      color: var(--text-light);
    }

    .btn-primary:hover {
      background: #4B0082;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(137, 6, 230, 0.3);
    }

    body[data-theme="light"] .btn-primary:hover {
      background: #6A00B3;
    }

    .table-card {
      background: var(--surface-dark);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      border: 1px solid var(--border-dark);
    }

    body[data-theme="light"] .table-card {
      background: var(--surface-light);
      border: 1px solid var(--border-light);
    }

    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .table-header h2 {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-dark);
    }

    body[data-theme="light"] .table-header h2 {
      color: var(--text-light);
    }

    .table-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .search-box {
      position: relative;
      display: flex;
      align-items: center;
    }

    .search-box i {
      position: absolute;
      left: 10px;
      color: var(--text-secondary-dark);
    }

    body[data-theme="light"] .search-box i {
      color: var(--text-secondary-light);
    }

    .search-box input {
      padding: 8px 8px 8px 32px;
      border: 1px solid var(--border-dark);
      border-radius: var(--border-radius);
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-dark);
      font-size: 14px;
      width: 200px;
      transition: var(--transition);
    }

    body[data-theme="light"] .search-box input {
      border: 1px solid var(--border-light);
      background: rgba(0, 0, 0, 0.05);
      color: var(--text-light);
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--primary-dark);
      box-shadow: 0 0 0 3px rgba(137, 6, 230, 0.2);
    }

    body[data-theme="light"] .search-box input:focus {
      border-color: var(--primary-light);
    }

    .table-responsive {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px;
      text-align: left;
      font-size: 14px;
      color: var(--text-dark);
    }

    body[data-theme="light"] th, body[data-theme="light"] td {
      color: var(--text-light);
    }

    th {
      font-weight: 600;
      border-bottom: 1px solid var(--border-dark);
    }

    body[data-theme="light"] th {
      border-bottom: 1px solid var(--border-light);
    }

    td {
      border-bottom: 1px solid var(--border-dark);
    }

    body[data-theme="light"] td {
      border-bottom: 1px solid var(--border-light);
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 500;
    }

    .badge-open {
      background: rgba(255, 159, 10, 0.2);
      color: var(--warning-light);
    }

    .badge-progress {
      background: rgba(5, 13, 235, 0.2);
      color: var(--primary-dark);
    }

    body[data-theme="light"] .badge-progress {
      color: var(--primary-light);
    }

    .badge-resolved {
      background: rgba(48, 209, 88, 0.2);
      color: var(--success-light);
    }

    .priority-low {
      background: rgba(48, 209, 88, 0.1);
    }

    .priority-medium {
      background: rgba(255, 159, 10, 0.1);
    }

    .priority-high {
      background: rgba(255, 69, 58, 0.1);
    }

    .btn-icon {
      background: transparent;
      border: none;
      color: var(--text-secondary-dark);
      cursor: pointer;
      font-size: 14px;
      padding: 6px;
      transition: var(--transition);
    }

    body[data-theme="light"] .btn-icon {
      color: var(--text-secondary-light);
    }

    .btn-icon:hover {
      color: var(--primary-dark);
    }

    body[data-theme="light"] .btn-icon:hover {
      color: var(--primary-light);
    }

    .empty-state {
      text-align: center;
      padding: 20px;
      color: var(--text-secondary-dark);
    }

    body[data-theme="light"] .empty-state {
      color: var(--text-secondary-light);
    }

    .empty-state i {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background: var(--surface-dark);
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
    }

    body[data-theme="light"] .modal-content {
      background: var(--surface-light);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-dark);
    }

    body[data-theme="light"] .modal-header {
      border-bottom: 1px solid var(--border-light);
    }

    .modal-header h3 {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-dark);
    }

    body[data-theme="light"] .modal-header h3 {
      color: var(--text-light);
    }

    .modal-header .close {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--text-secondary-dark);
    }

    body[data-theme="light"] .modal-header .close {
      color: var(--text-secondary-light);
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      padding: 16px 20px;
      border-top: 1px solid var(--border-dark);
      text-align: right;
    }

    body[data-theme="light"] .modal-footer {
      border-top: 1px solid var(--border-light);
    }

    .btn-cancel {
      background: var(--danger-light);
      color: var(--text-dark);
      border: none;
      padding: 10px 16px;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
    }

    body[data-theme="light"] .btn-cancel {
      color: var(--text-light);
    }

    .btn-cancel:hover {
      background: #D70015;
    }

    .incident-details .detail-row {
      display: flex;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .detail-label {
      font-weight: 600;
      color: var(--text-secondary-dark);
      width: 120px;
      flex-shrink: 0;
    }

    body[data-theme="light"] .detail-label {
      color: var(--text-secondary-light);
    }

    .detail-value {
      color: var(--text-dark);
      flex: 1;
    }

    body[data-theme="light"] .detail-value {
      color: var(--text-light);
    }

    .timeline {
      margin-top: 20px;
    }

    .timeline-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 12px;
    }

    body[data-theme="light"] .timeline-title {
      color: var(--text-light);
    }

    .timeline-item {
      display: flex;
      margin-bottom: 12px;
    }

    .timeline-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: rgba(137, 6, 230, 0.2);
      color: var(--primary-dark);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      flex-shrink: 0;
    }

    body[data-theme="light"] .timeline-icon {
      color: var(--primary-light);
    }

    .timeline-content {
      flex: 1;
    }

    .timeline-date {
      font-size: 12px;
      color: var(--text-secondary-dark);
      margin-bottom: 4px;
    }

    body[data-theme="light"] .timeline-date {
      color: var(--text-secondary-light);
    }

    .timeline-text {
      font-size: 14px;
      color: var(--text-dark);
    }

    body[data-theme="light"] .timeline-text {
      color: var(--text-light);
    }

    .theme-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary-dark);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      z-index: 100;
      transition: var(--transition);
    }

    body[data-theme="light"] .theme-toggle {
      background: var(--primary-light);
    }

    .theme-toggle:hover {
      transform: scale(1.1);
    }

    @media (max-width: 1200px) {
      .charts-section {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 992px) {
      .dashboard-container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--border-dark);
      }

      body[data-theme="light"] .sidebar {
        border-bottom: 1px solid var(--border-light);
      }

      .nav-menu {
        display: flex;
        overflow-x: auto;
        padding: 0 12px 12px;
      }

      .nav-item {
        flex-shrink: 0;
      }

      .nav-link {
        padding: 10px 14px;
      }

      .main-content {
        padding: 20px;
      }
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .btn-group {
        width: 100%;
        justify-content: space-between;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .header h1 {
        font-size: 24px;
      }

      .chart-card {
        padding: 16px;
      }
    }

    @media (max-width: 576px) {
      .main-content {
        padding: 16px;
      }

      .header h1 {
        font-size: 20px;
      }

      .search-box input {
        width: 100%;
      }

      .table-responsive {
        font-size: 12px;
      }

      th, td {
        padding: 8px;
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .form-card,
    .table-card,
    .chart-card {
      animation: fadeIn 0.5s ease-out forwards;
    }

    .chart-card:nth-child(2) { animation-delay: 0.1s; }
    .chart-card:nth-child(3) { animation-delay: 0.2s; }
    .chart-card:nth-child(4) { animation-delay: 0.3s; }
  </style>
</head>
<body data-theme="dark">
  <div class="dashboard-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="logo1.png" alt="Solution Tecnologia Logo" class="logo">
        <h2> Solution Tecnologia</h2>
      </div>

      <div class="user-info">
        <p>Bem-vindo, <strong id="username">Usuário</strong></p>
        <p><span class="role-badge" id="userrole">Usuário</span></p>
      </div>

      <ul class="nav-menu">
        <li class="nav-item">
          <a href="dashboard-user.html" class="nav-link">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="itilusuario.html" class="nav-link active">
            <i class="fas fa-tasks"></i>
            <span>Meus Chamados</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="lgpd-user.html" class="nav-link">
            <i class="fas fa-shield-alt"></i>
            <span>LGPD - Requisições</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="support.html" class="nav-link">
            <i class="fas fa-headset"></i>
            <span>Suporte</span>
          </a>
        </li>
      </ul>

      <div class="sidebar-footer">
        Speedpro Faculdade &copy; 2025
      </div>
    </aside>

    <main class="main-content">
      <div class="header">
        <h1><i class="fas fa-tasks"></i> ITIL - Abertura de Chamados</h1>
        <div class="btn-group">
          <a href="dashboard-user.html" class="back-btn">
            <i class="fas fa-arrow-left"></i> Voltar
          </a>
          <button class="logout-btn" onclick="window.location.href='../../login.html'" aria-label="Sair">
            <i class="fas fa-sign-out-alt"></i> Sair
          </button>
        </div>
      </div>

      <div class="stats-section">
        <div class="stat-card stat-open">
          <div class="stat-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-value" id="open-count">0</div>
          <div class="stat-label">Abertos</div>
        </div>
        <div class="stat-card stat-progress">
          <div class="stat-icon">
            <i class="fas fa-spinner"></i>
          </div>
          <div class="stat-value" id="progress-count">0</div>
          <div class="stat-label">Em Andamento</div>
        </div>
        <div class="stat-card stat-resolved">
          <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-value" id="resolved-count">0</div>
          <div class="stat-label">Resolvidos</div>
        </div>
        <div class="stat-card stat-total">
          <div class="stat-icon">
            <i class="fas fa-list-alt"></i>
          </div>
          <div class="stat-value" id="total-count">0</div>
          <div class="stat-label">Total</div>
        </div>
      </div>

      <div class="charts-section">
        <div class="chart-card">
          <div class="chart-header">
            <h3>Distribuição de Status</h3>
            <select class="chart-filter" id="status-filter" aria-label="Filtro de Status">
              <option value="week">Esta Semana</option>
              <option value="month" selected>Este Mês</option>
              <option value="all">Todos</option>
            </select>
          </div>
          <div class="chart-container">
            <canvas id="status-chart" role="img" aria-label="Gráfico de Distribuição de Status dos Chamados"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <h3>Prioridade dos Chamados</h3>
            <select class="chart-filter" id="priority-filter" aria-label="Filtro de Prioridade">
              <option value="week">Esta Semana</option>
              <option value="month" selected>Este Mês</option>
              <option value="all">Todos</option>
            </select>
          </div>
          <div class="chart-container">
            <canvas id="priority-chart" role="img" aria-label="Gráfico de Prioridade dos Chamados"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <h3>Chamados por Período</h3>
            <select class="chart-filter" id="time-filter" aria-label="Filtro de Período">
              <option value="week">Esta Semana</option>
              <option value="month" selected>Este Mês</option>
              <option value="all">Todos</option>
            </select>
          </div>
          <div class="chart-container">
            <canvas id="time-chart" role="img" aria-label="Gráfico de Chamados por Período"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <h3>Tempo Médio de Resolução</h3>
            <select class="chart-filter" id="resolution-filter" aria-label="Filtro de Resolução">
              <option value="week">Esta Semana</option>
              <option value="month" selected>Este Mês</option>
              <option value="all">Todos</option>
            </select>
          </div>
          <div class="chart-container">
            <canvas id="resolution-chart" role="img" aria-label="Gráfico de Tempo Médio de Resolução"></canvas>
          </div>
        </div>
      </div>

      <div class="form-card">
        <h2>Abrir Novo Chamado</h2>
        <form id="incident-form" role="form" aria-labelledby="form-title">
          <div class="form-row">
            <div class="form-group">
              <label for="incident-title">Título do Chamado *</label>
              <input type="text" id="incident-title" class="form-control" placeholder="Ex: Sistema indisponível" required aria-required="true">
            </div>

            <div class="form-group">
              <label for="incident-priority">Prioridade *</label>
              <select id="incident-priority" class="form-control" required aria-required="true">
                <option value="">Selecione a prioridade</option>
                <option value="Baixa">Baixa</option>
                <option value="Média">Média</option>
                <option value="Alta">Alta</option>
              </select>
            </div>

            <div class="form-group">
              <label for="incident-category">Categoria *</label>
              <select id="incident-category" class="form-control" required aria-required="true">
                <option value="">Selecione a categoria</option>
                <option value="Hardware">Hardware</option>
                <option value="Software">Software</option>
                <option value="Rede">Rede</option>
                <option value="Acesso">Acesso</option>
                <option value="Outros">Outros</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="incident-description">Descrição do Chamado *</label>
            <textarea id="incident-description" class="form-control" rows="5" placeholder="Descreva detalhadamente o problema..." required aria-required="true"></textarea>
          </div>

          <button type="submit" class="btn-primary" aria-label="Criar Chamado">
            <i class="fas fa-plus"></i> Criar Chamado
          </button>
        </form>
      </div>

      <div class="table-card">
        <div class="table-header">
          <h2>Meus Chamados</h2>
          <div class="table-actions">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input type="text" id="search-input" placeholder="Buscar chamado..." aria-label="Buscar chamado">
            </div>
          </div>
        </div>

        <div class="table-responsive">
          <table role="grid">
            <thead>
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Título</th>
                <th scope="col">Categoria</th>
                <th scope="col">Prioridade</th>
                <th scope="col">Status</th>
                <th scope="col">Data</th>
                <th scope="col">Ações</th>
              </tr>
            </thead>
            <tbody id="incidents-table"></tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <div class="modal" id="detailsModal" role="dialog" aria-labelledby="modal-title">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-title">Detalhes do Chamado</h3>
        <button class="close" id="closeDetails" aria-label="Fechar">&times;</button>
      </div>
      <div class="modal-body" id="detailsContent"></div>
      <div class="modal-footer">
        <button class="btn-cancel" id="closeDetailsBtn" aria-label="Fechar">Fechar</button>
      </div>
    </div>
  </div>

  <div class="theme-toggle" id="theme-toggle" role="button" aria-label="Alternar Tema">
    <i class="fas fa-sun"></i>
  </div>

  <script>
    let incidents = JSON.parse(localStorage.getItem('incidents')) || [];
    let statusChart, priorityChart, timeChart, resolutionChart;

    function initializeData() {
      if (!localStorage.getItem('incidents')) {
        const sampleIncidents = [
          { id: "INC-0001", requester: "Usuário", title: "Problema com WiFi", category: "Rede", priority: "Média", status: "Aberto", description: "Não consigo conectar à rede WiFi do laboratório 2. O problema começou hoje pela manhã.", createdAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(), history: [{ type: "create", text: "Chamado criado", date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString() }] },
          { id: "INC-0002", requester: "Usuário", title: "Acesso ao sistema negado", category: "Acesso", priority: "Alta", status: "Em Andamento", description: "Erro de login no sistema acadêmico. Após inserir minhas credenciais, recebo a mensagem 'Acesso negado'.", createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(), history: [{ type: "create", text: "Chamado criado", date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString() }, { type: "update", text: "Em análise", date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString() }] },
          { id: "INC-0003", requester: "Usuário", title: "Impressora não funciona", category: "Hardware", priority: "Baixa", status: "Resolvido", description: "Impressora do laboratório 1 não responde. A luz de erro está piscando em vermelho.", createdAt: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(), resolvedAt: new Date(Date.now() - 8 * 24 * 60 * 60 * 1000).toISOString(), history: [{ type: "create", text: "Chamado criado", date: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString() }, { type: "resolve", text: "Problema resolvido", date: new Date(Date.now() - 8 * 24 * 60 * 60 * 1000).toISOString() }], resolution: "Impressora reiniciada e papel preso removido." },
          { id: "INC-0004", requester: "Usuário", title: "Erro no software de design", category: "Software", priority: "Alta", status: "Resolvido", description: "Erro ao salvar arquivos no software de design gráfico. A aplicação fecha inesperadamente.", createdAt: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString(), resolvedAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(), history: [{ type: "create", text: "Chamado criado", date: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString() }, { type: "resolve", text: "Atualização aplicada", date: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString() }], resolution: "Software atualizado para a versão mais recente." },
          { id: "INC-0005", requester: "Usuário", title: "Problema de rede no laboratório", category: "Rede", priority: "Média", status: "Aberto", description: "Conexão instável no laboratório 3. A internet cai frequentemente durante as aulas.", createdAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(), history: [{ type: "create", text: "Chamado criado", date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString() }] },
          { id: "INC-0006", requester: "Usuário", title: "Teclado com teclas travando", category: "Hardware", priority: "Baixa", status: "Em Andamento", description: "Teclado do computador 5 no laboratório 2 está com várias teclas travando.", createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(), history: [{ type: "create", text: "Chamado criado", date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString() }, { type: "update", text: "Aguardando peça de reposição", date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString() }] },
          { id: "INC-0007", requester: "Usuário", title: "Software de programação não abre", category: "Software", priority: "Média", status: "Resolvido", description: "IDE de programação não inicia. Aparece erro de licença expirada.", createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(), resolvedAt: new Date(Date.now() - 6 * 24 * 60 * 60 * 1000).toISOString(), history: [{ type: "create", text: "Chamado criado", date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString() }, { type: "resolve", text: "Licença renovada", date: new Date(Date.now() - 6 * 24 * 60 * 60 * 1000).toISOString() }], resolution: "Licença do software renovada com sucesso." }
        ];
        localStorage.setItem('incidents', JSON.stringify(sampleIncidents));
        incidents = sampleIncidents;
      }
    }

    function generateId() {
      return 'INC-' + String(incidents.length + 1).padStart(4, '0');
    }

    function formatDate(date) {
      const d = new Date(date);
      return `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${d.getFullYear()}`;
    }

    function formatDateTime(date) {
      const d = new Date(date);
      return `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${d.getFullYear()} ${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}`;
    }

    function updateStats() {
      const user = JSON.parse(localStorage.getItem('user')) || { username: 'Usuário' };
      const filteredIncidents = incidents.filter(incident => incident.requester === user.username);
      
      const openCount = filteredIncidents.filter(i => i.status === 'Aberto').length;
      const progressCount = filteredIncidents.filter(i => i.status === 'Em Andamento').length;
      const resolvedCount = filteredIncidents.filter(i => i.status === 'Resolvido').length;
      const totalCount = filteredIncidents.length;
      
      document.getElementById('open-count').textContent = openCount;
      document.getElementById('progress-count').textContent = progressCount;
      document.getElementById('resolved-count').textContent = resolvedCount;
      document.getElementById('total-count').textContent = totalCount;
    }

    function createCharts() {
      const user = JSON.parse(localStorage.getItem('user')) || { username: 'Usuário' };
      const filteredIncidents = incidents.filter(incident => incident.requester === user.username);

      const statusFilter = document.getElementById('status-filter').value;
      const priorityFilter = document.getElementById('priority-filter').value;
      const timeFilter = document.getElementById('time-filter').value;
      const resolutionFilter = document.getElementById('resolution-filter').value;

      const now = new Date();
      const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
      const oneMonthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);

      const filterByTime = (items, filter) => {
        if (filter === 'week') return items.filter(item => new Date(item.createdAt) >= oneWeekAgo);
        if (filter === 'month') return items.filter(item => new Date(item.createdAt) >= oneMonthAgo);
        return items;
      };

      // Status Chart (Pie)
      const statusData = {
        labels: ['Aberto', 'Em Andamento', 'Resolvido'],
        datasets: [{
          data: [
            filterByTime(filteredIncidents, statusFilter).filter(i => i.status === 'Aberto').length,
            filterByTime(filteredIncidents, statusFilter).filter(i => i.status === 'Em Andamento').length,
            filterByTime(filteredIncidents, statusFilter).filter(i => i.status === 'Resolvido').length
          ],
          backgroundColor: ['#FF9F0A', '#050DEB', '#30D158'],
          borderWidth: 0,
          hoverOffset: 10
        }]
      };

      // Priority Chart (Bar)
      const priorityData = {
        labels: ['Alta', 'Média', 'Baixa'],
        datasets: [{
          label: 'Número de Chamados',
          data: [
            filterByTime(filteredIncidents, priorityFilter).filter(i => i.priority === 'Alta').length,
            filterByTime(filteredIncidents, priorityFilter).filter(i => i.priority === 'Média').length,
            filterByTime(filteredIncidents, priorityFilter).filter(i => i.priority === 'Baixa').length
          ],
          backgroundColor: ['#FF453A', '#FF9F0A', '#30D158'],
          borderRadius: 4,
          barThickness: 40
        }]
      };

      // Time Chart (Line)
      const timeData = {
        labels: timeFilter === 'week' ? 
          Array(7).fill().map((_, i) => {
            const d = new Date(now.getTime() - (6 - i) * 24 * 60 * 60 * 1000);
            return `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}`;
          }) :
          Array(30).fill().map((_, i) => {
            const d = new Date(now.getTime() - (29 - i) * 24 * 60 * 60 * 1000);
            return `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}`;
          }),
        datasets: [{
          label: 'Chamados Criados',
          data: timeFilter === 'week' ?
            Array(7).fill().map((_, i) => {
              const date = new Date(now.getTime() - (6 - i) * 24 * 60 * 60 * 1000);
              return filterByTime(filteredIncidents, timeFilter).filter(i => {
                const created = new Date(i.createdAt);
                return created.getDate() === date.getDate() && created.getMonth() === date.getMonth() && created.getFullYear() === date.getFullYear();
              }).length;
            }) :
            Array(30).fill().map((_, i) => {
              const date = new Date(now.getTime() - (29 - i) * 24 * 60 * 60 * 1000);
              return filterByTime(filteredIncidents, timeFilter).filter(i => {
                const created = new Date(i.createdAt);
                return created.getDate() === date.getDate() && created.getMonth() === date.getMonth() && created.getFullYear() === date.getFullYear();
              }).length;
            }),
          borderColor: '#050DEB',
          backgroundColor: 'rgba(5, 13, 235, 0.2)',
          fill: true,
          tension: 0.4
        }]
      };

      // Resolution Time Chart (Doughnut)
      const resolutionData = {
        labels: ['Alta', 'Média', 'Baixa'],
        datasets: [{
          data: [
            calculateAverageResolutionTime(filterByTime(filteredIncidents, resolutionFilter).filter(i => i.priority === 'Alta' && i.resolvedAt)),
            calculateAverageResolutionTime(filterByTime(filteredIncidents, resolutionFilter).filter(i => i.priority === 'Média' && i.resolvedAt)),
            calculateAverageResolutionTime(filterByTime(filteredIncidents, resolutionFilter).filter(i => i.priority === 'Baixa' && i.resolvedAt))
          ],
          backgroundColor: ['#FF453A', '#FF9F0A', '#30D158'],
          borderWidth: 0,
          hoverOffset: 10
        }]
      };

      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--text-dark').trim(),
              font: { size: 12 },
              padding: 20
            }
          },
          tooltip: {
            callbacks: {
              label: context => {
                if (context.dataset.label === 'Número de Chamados') {
                  return `${context.label}: ${context.raw} chamados`;
                } else if (context.dataset.label === 'Chamados Criados') {
                  return `${context.label}: ${context.raw} chamados`;
                } else if (context.dataset.label) {
                  return `${context.label}: ${context.raw.toFixed(1)} dias`;
                }
                return `${context.label}: ${context.raw}`;
              }
            }
          }
        },
        animation: {
          animateScale: true,
          animateRotate: true
        }
      };

      const statusCtx = document.getElementById('status-chart').getContext('2d');
      const priorityCtx = document.getElementById('priority-chart').getContext('2d');
      const timeCtx = document.getElementById('time-chart').getContext('2d');
      const resolutionCtx = document.getElementById('resolution-chart').getContext('2d');

      if (statusChart) statusChart.destroy();
      if (priorityChart) priorityChart.destroy();
      if (timeChart) timeChart.destroy();
      if (resolutionChart) resolutionChart.destroy();

      statusChart = new Chart(statusCtx, { type: 'pie', data: statusData, options: chartOptions });
      priorityChart = new Chart(priorityCtx, { type: 'bar', data: priorityData, options: { ...chartOptions, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } } });
      timeChart = new Chart(timeCtx, { type: 'line', data: timeData, options: { ...chartOptions, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } } });
      resolutionChart = new Chart(resolutionCtx, { type: 'doughnut', data: resolutionData, options: chartOptions });
    }

    function calculateAverageResolutionTime(incidents) {
      if (incidents.length === 0) return 0;
      const totalTime = incidents.reduce((sum, i) => {
        const created = new Date(i.createdAt);
        const resolved = new Date(i.resolvedAt);
        return sum + (resolved - created) / (1000 * 60 * 60 * 24); // Convert to days
      }, 0);
      return totalTime / incidents.length;
    }

    function renderIncidents() {
      const user = JSON.parse(localStorage.getItem('user')) || { username: 'Usuário' };
      const tableBody = document.getElementById('incidents-table');
      const searchTerm = document.getElementById('search-input').value.toLowerCase();

      let filteredIncidents = incidents.filter(incident => 
        incident.requester === user.username && 
        (incident.title.toLowerCase().includes(searchTerm) || 
         incident.description.toLowerCase().includes(searchTerm) ||
         incident.category.toLowerCase().includes(searchTerm))
      );

      if (filteredIncidents.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="7" class="empty-state">
              <i class="fas fa-inbox"></i>
              <p>Nenhum chamado encontrado</p>
            </td>
          </tr>
        `;
        return;
      }

      tableBody.innerHTML = filteredIncidents.map(incident => {
        let badgeClass = 'badge-open';
        if (incident.status === 'Em Andamento') badgeClass = 'badge-progress';
        if (incident.status === 'Resolvido') badgeClass = 'badge-resolved';
        let priorityClass = 'priority-low';
        if (incident.priority === 'Média') priorityClass = 'priority-medium';
        if (incident.priority === 'Alta') priorityClass = 'priority-high';

        return `
          <tr class="${priorityClass}">
            <td>${incident.id}</td>
            <td>${incident.title}</td>
            <td>${incident.category}</td>
            <td>${incident.priority}</td>
            <td><span class="badge ${badgeClass}">${incident.status}</span></td>
            <td>${formatDate(incident.createdAt)}</td>
            <td class="actions">
              <button class="btn-icon btn-view" title="Detalhes" data-id="${incident.id}" aria-label="Ver detalhes do chamado ${incident.id}">
                <i class="fas fa-eye"></i>
              </button>
            </td>
          </tr>
        `;
      }).join('');

      document.querySelectorAll('.btn-view').forEach(button => {
        button.addEventListener('click', (e) => {
          const incidentId = e.currentTarget.getAttribute('data-id');
          showDetailsModal(incidentId);
        });
      });
    }

    function showDetailsModal(id) {
      const incident = incidents.find(i => i.id === id);
      if (!incident) return;

      document.getElementById('detailsContent').innerHTML = `
        <div class="incident-details">
          <div class="detail-row"><span class="detail-label">ID:</span><span class="detail-value">${incident.id}</span></div>
          <div class="detail-row"><span class="detail-label">Solicitante:</span><span class="detail-value">${incident.requester}</span></div>
          <div class="detail-row"><span class="detail-label">Título:</span><span class="detail-value">${incident.title}</span></div>
          <div class="detail-row"><span class="detail-label">Categoria:</span><span class="detail-value">${incident.category}</span></div>
          <div class="detail-row"><span class="detail-label">Prioridade:</span><span class="detail-value">${incident.priority}</span></div>
          <div class="detail-row"><span class="detail-label">Status:</span><span class="detail-value">${incident.status}</span></div>
          <div class="detail-row"><span class="detail-label">Data de Criação:</span><span class="detail-value">${formatDate(incident.createdAt)}</span></div>
          <div class="detail-row"><span class="detail-label">Descrição:</span><span class="detail-value">${incident.description || 'Nenhuma descrição'}</span></div>
          ${incident.resolution ? `<div class="detail-row"><span class="detail-label">Resolução:</span><span class="detail-value">${incident.resolution}</span></div>` : ''}
          ${incident.history && incident.history.length > 0 ? `
          <div class="timeline">
            <div class="timeline-title">Histórico de Alterações</div>
            ${incident.history.map(item => `
              <div class="timeline-item">
                <div class="timeline-icon"><i class="fas fa-clock"></i></div>
                <div class="timeline-content">
                  <div class="timeline-date">${formatDateTime(item.date)}</div>
                  <div class="timeline-text">${item.text}</div>
                </div>
              </div>
            `).join('')}
          </div>
          ` : ''}
        </div>
      `;
      document.getElementById('detailsModal').style.display = 'flex';
      document.querySelector('.modal-content').focus();
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
      document.querySelector('.main-content').focus();
    }

    function toggleTheme() {
      const body = document.body;
      const currentTheme = body.getAttribute('data-theme');
      const themeToggle = document.getElementById('theme-toggle');

      if (currentTheme === 'light') {
        body.setAttribute('data-theme', 'dark');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        localStorage.setItem('theme', 'dark');
      } else {
        body.setAttribute('data-theme', 'light');
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        localStorage.setItem('theme', 'light');
      }

      if (statusChart) statusChart.update();
      if (priorityChart) priorityChart.update();
      if (timeChart) timeChart.update();
      if (resolutionChart) resolutionChart.update();
    }

    function logout() {
      if (confirm('Tem certeza que deseja sair?')) {
        localStorage.removeItem('user');
        alert('Logout realizado com sucesso!');
        window.location.href = 'login.html';
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      initializeData();

      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.body.setAttribute('data-theme', savedTheme);
      document.getElementById('theme-toggle').innerHTML = savedTheme === 'light' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';

      const user = JSON.parse(localStorage.getItem('user')) || { username: 'Usuário', role: 'Usuário', type: 'user', email: 'usuario@faculdade.edu' };
      document.getElementById('username').textContent = user.username;
      document.getElementById('userrole').textContent = user.role;

      if (user.type !== 'user') {
        alert('Acesso não autorizado. Redirecionando para login.');
        logout();
        return;
      }

      updateStats();
      renderIncidents();
      createCharts();

      document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
      document.getElementById('incident-form').addEventListener('submit', function(e) {
        e.preventDefault();

        const user = JSON.parse(localStorage.getItem('user')) || { username: 'Usuário', email: 'usuario@faculdade.edu' };
        const id = generateId();
        const title = document.getElementById('incident-title').value;
        const category = document.getElementById('incident-category').value;
        const priority = document.getElementById('incident-priority').value;
        const description = document.getElementById('incident-description').value;
        const createdAt = new Date().toISOString();
        const now = new Date().toISOString();

        const incident = {
          id,
          requester: user.username,
          title,
          category,
          priority,
          status: 'Aberto',
          description,
          createdAt,
          history: [{ type: 'create', text: 'Chamado criado', date: now }]
        };

        incidents.push(incident);
        localStorage.setItem('incidents', JSON.stringify(incidents));
        alert('Chamado criado com sucesso!');
        document.getElementById('incident-form').reset();
        updateStats();
        renderIncidents();
        createCharts();
      });

      document.getElementById('search-input').addEventListener('input', renderIncidents);
      document.getElementById('status-filter').addEventListener('change', createCharts);
      document.getElementById('priority-filter').addEventListener('change', createCharts);
      document.getElementById('time-filter').addEventListener('change', createCharts);
      document.getElementById('resolution-filter').addEventListener('change', createCharts);

      document.getElementById('closeDetails').addEventListener('click', () => closeModal('detailsModal'));
      document.getElementById('closeDetailsBtn').addEventListener('click', () => closeModal('detailsModal'));

      window.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal')) {
          closeModal(e.target.id);
        }
      });

      document.getElementById('detailsModal').addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeModal('detailsModal');
        }
      });
    });
  </script>
</body>
</html>