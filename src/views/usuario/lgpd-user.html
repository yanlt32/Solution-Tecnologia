<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Módulo LGPD - Solution Tecnologia</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --primary-light: #8906e6; /* Roxo */
        --primary-dark: #050deb; /* Azul */
        --secondary-light: #ff00e2; /* Rosa */
        --accent-light: #ff9f0a;
        --success-light: #30d158;
        --danger-light: #ff453a;
        --warning-light: #ff9f0a;
        --text-light: #1c1c1e;
        --text-secondary-light: #636366;
        --background-light: #f5f5f7;
        --surface-light: #ffffff;
        --border-light: #e5e5ea;
        --primary: #8906e6; /* For Chart.js compatibility */

        --primary-dark-dark: #ff00e2; /* Rosa */
        --secondary-dark: #050deb; /* Azul */
        --accent-dark: #ff9f0a;
        --success-dark: #30d158;
        --danger-dark: #ff453a;
        --warning-dark: #ff9f0a;
        --text-dark: #ffffff;
        --text-secondary-dark: #a1a1a6;
        --background-dark: #121212;
        --surface-dark: #1e1e1e;
        --border-dark: #2c2c2e;

        --border-radius: 12px;
        --sidebar-width: 240px;
        --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "SF Pro Display", sans-serif;
      }

      body {
        background-color: var(--background-dark);
        color: var(--text-dark);
        line-height: 1.6;
        font-weight: 400;
        -webkit-font-smoothing: antialiased;
        transition: background-color 0.3s ease;
      }

      body[data-theme="light"] {
        background-color: var(--background-light);
        color: var(--text-light);
      }

      .dashboard-container {
        display: flex;
        min-height: 100vh;
      }

      .sidebar {
        width: var(--sidebar-width);
        background: var(--surface-dark);
        color: var(--text-dark);
        padding: 0;
        transition: var(--transition);
        border-right: 1px solid var(--border-dark);
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
      }

      body[data-theme="light"] .sidebar {
        background: var(--surface-light);
        color: var(--text-light);
        border-right: 1px solid var(--border-light);
      }

      .sidebar-header {
        padding: 24px 20px;
        border-bottom: 1px solid var(--border-dark);
        text-align: center;
      }

      body[data-theme="light"] .sidebar-header {
        border-bottom: 1px solid var(--border-light);
      }

      .sidebar-header img.logo {
        width: 80px;
        height: auto;
        margin-bottom: 8px;
      }

      .sidebar-header h2 {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        font-size: 20px;
        font-weight: 700;
        color: var(--text-dark);
      }

      body[data-theme="light"] .sidebar-header h2 {
        color: var(--text-light);
      }

      .sidebar-header h2 i {
        color: var(--primary-dark);
        background: rgba(137, 6, 230, 0.2);
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      body[data-theme="light"] .sidebar-header h2 i {
        color: var(--primary-light);
      }

      .user-info {
        padding: 20px;
        margin-bottom: 0;
        border-bottom: 1px solid var(--border-dark);
      }

      body[data-theme="light"] .user-info {
        border-bottom: 1px solid var(--border-light);
      }

      .user-info p {
        margin-bottom: 6px;
        font-size: 14px;
        color: var(--text-secondary-dark);
      }

      body[data-theme="light"] .user-info p {
        color: var(--text-secondary-light);
      }

      .user-info .role-badge {
        display: inline-block;
        background: var(--primary-dark);
        color: var(--text-dark);
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        margin-top: 6px;
      }

      body[data-theme="light"] .user-info .role-badge {
        background: var(--primary-light);
        color: var(--text-light);
      }

      .nav-menu {
        list-style: none;
        padding: 12px;
        flex-grow: 1;
      }

      .nav-item {
        margin-bottom: 4px;
      }

      .nav-link {
        display: flex;
        align-items: center;
        padding: 12px 14px;
        color: var(--text-secondary-dark);
        text-decoration: none;
        transition: var(--transition);
        gap: 10px;
        border-radius: var(--border-radius);
        font-size: 14px;
        font-weight: 500;
        position: relative;
      }

      body[data-theme="light"] .nav-link {
        color: var(--text-secondary-light);
      }

      .nav-link:hover {
        background: rgba(137, 6, 230, 0.1);
        color: var(--primary-dark);
      }

      body[data-theme="light"] .nav-link:hover {
        color: var(--primary-light);
      }

      .nav-link.active {
        background: rgba(137, 6, 230, 0.2);
        color: var(--primary-dark);
        font-weight: 600;
      }

      body[data-theme="light"] .nav-link.active {
        color: var(--primary-light);
      }

      .nav-link.active::before {
        content: "";
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        height: 18px;
        width: 4px;
        background: var(--primary-dark);
        border-radius: 0 2px 2px 0;
      }

      body[data-theme="light"] .nav-link.active::before {
        background: var(--primary-light);
      }

      .nav-link i {
        width: 18px;
        text-align: center;
        font-size: 16px;
      }

      .sidebar-footer {
        padding: 12px;
        border-top: 1px solid var(--border-dark);
        font-size: 11px;
        color: var(--text-secondary-dark);
        text-align: center;
      }

      body[data-theme="light"] .sidebar-footer {
        border-top: 1px solid var(--border-light);
        color: var(--text-secondary-light);
      }

      .main-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        background: var(--background-dark);
      }

      body[data-theme="light"] .main-content {
        background: var(--background-light);
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid var(--border-dark);
      }

      body[data-theme="light"] .header {
        border-bottom: 1px solid var(--border-light);
      }

      .header h1 {
        color: var(--text-dark);
        font-size: 28px;
        font-weight: 700;
        letter-spacing: -0.5px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      body[data-theme="light"] .header h1 {
        color: var(--text-light);
      }

      .btn-group {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .back-btn,
      .logout-btn {
        background: var(--danger-light);
        color: var(--text-dark);
        border: none;
        padding: 10px 16px;
        border-radius: var(--border-radius);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: var(--transition);
        font-weight: 500;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(255, 69, 58, 0.2);
        text-decoration: none;
      }

      body[data-theme="light"] .back-btn,
      body[data-theme="light"] .logout-btn {
        color: var(--text-light);
      }

      .back-btn:hover,
      .logout-btn:hover {
        background: #d70015;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(255, 69, 58, 0.3);
      }

      .welcome-banner {
        background: linear-gradient(
          135deg,
          var(--primary-dark),
          var(--primary-dark-dark)
        );
        color: var(--text-dark);
        padding: 24px;
        border-radius: var(--border-radius);
        margin-bottom: 24px;
        box-shadow: 0 10px 30px rgba(137, 6, 230, 0.25);
        position: relative;
        overflow: hidden;
        transition: transform 0.3s ease;
      }

      body[data-theme="light"] .welcome-banner {
        background: linear-gradient(
          135deg,
          var(--primary-light),
          var(--primary-dark)
        );
        color: var(--text-light);
      }

      .welcome-banner:hover {
        transform: translateY(-5px);
      }

      .welcome-banner::before {
        content: "";
        position: absolute;
        top: -50%;
        right: -20%;
        width: 300px;
        height: 300px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
      }

      .welcome-banner h2 {
        margin-bottom: 10px;
        font-size: 22px;
        font-weight: 700;
        position: relative;
        z-index: 1;
      }

      .welcome-banner p {
        opacity: 0.9;
        font-size: 15px;
        max-width: 500px;
        position: relative;
        z-index: 1;
      }

      .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }

      .stat-card {
        background: var(--surface-dark);
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        gap: 14px;
        border: 1px solid var(--border-dark);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      body[data-theme="light"] .stat-card {
        background: var(--surface-light);
        border: 1px solid var(--border-light);
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      }

      .stat-card::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--primary-dark);
      }

      body[data-theme="light"] .stat-card::after {
        background: var(--primary-light);
      }

      .stat-card:nth-child(2)::after {
        background: var(--warning-light);
      }
      .stat-card:nth-child(3)::after {
        background: var(--success-light);
      }

      .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: var(--text-dark);
        transition: transform 0.3s ease;
      }

      body[data-theme="light"] .stat-icon {
        color: var(--text-light);
      }

      .stat-card:hover .stat-icon {
        transform: scale(1.1);
      }

      .stat-pending {
        background: var(--warning-light);
        box-shadow: 0 6px 15px rgba(255, 159, 10, 0.3);
      }
      .stat-progress {
        background: var(--primary-dark);
        box-shadow: 0 6px 15px rgba(137, 6, 230, 0.3);
      }
      .stat-completed {
        background: var(--success-light);
        box-shadow: 0 6px 15px rgba(48, 209, 88, 0.3);
      }

      body[data-theme="light"] .stat-progress {
        background: var(--primary-light);
      }

      .stat-info h3 {
        font-size: 28px;
        font-weight: 800;
        margin-bottom: 4px;
        color: var(--text-dark);
        letter-spacing: -0.5px;
      }

      body[data-theme="light"] .stat-info h3 {
        color: var(--text-light);
      }

      .stat-info p {
        color: var(--text-secondary-dark);
        font-size: 14px;
        font-weight: 500;
      }

      body[data-theme="light"] .stat-info p {
        color: var(--text-secondary-light);
      }

      .form-card {
        background: var(--surface-dark);
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 24px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        border: 1px solid var(--border-dark);
      }

      body[data-theme="light"] .form-card {
        background: var(--surface-light);
        border: 1px solid var(--border-light);
      }

      .form-card h2 {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 16px;
        color: var(--text-dark);
      }

      body[data-theme="light"] .form-card h2 {
        color: var(--text-light);
      }

      .form-row {
        display: flex;
        gap: 16px;
        margin-bottom: 16px;
        flex-wrap: wrap;
      }

      .form-group {
        flex: 1;
        min-width: 200px;
      }

      .form-group label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 8px;
        color: var(--text-dark);
      }

      body[data-theme="light"] .form-group label {
        color: var(--text-light);
      }

      .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border-dark);
        border-radius: var(--border-radius);
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-dark);
        font-size: 14px;
        transition: var(--transition);
      }

      body[data-theme="light"] .form-control {
        border: 1px solid var(--border-light);
        background: var(--surface-light);
        color: var(--text-light);
      }

      .form-control:focus {
        outline: none;
        border-color: var(--primary-dark);
        box-shadow: 0 0 0 3px rgba(137, 6, 230, 0.2);
      }

      body[data-theme="light"] .form-control:focus {
        border-color: var(--primary-light);
      }

      .form-control[readonly] {
        background: rgba(255, 255, 255, 0.03);
        cursor: not-allowed;
      }

      body[data-theme="light"] .form-control[readonly] {
        background: rgba(0, 0, 0, 0.03);
      }

      .form-control option {
        background: var(--surface-dark);
        color: var(--text-dark);
      }

      body[data-theme="light"] .form-control option {
        background: var(--surface-light);
        color: var(--text-light);
      }

      .btn-primary {
        background: var(--primary-dark);
        color: var(--text-dark);
        border: none;
        padding: 12px 20px;
        border-radius: var(--border-radius);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        font-weight: 500;
        transition: var(--transition);
        box-shadow: 0 4px 12px rgba(137, 6, 230, 0.2);
      }

      body[data-theme="light"] .btn-primary {
        background: var(--primary-light);
        color: var(--text-light);
      }

      .btn-primary:hover {
        background: #3b0a9b;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(137, 6, 230, 0.3);
      }

      body[data-theme="light"] .btn-primary:hover {
        background: #6b05b3;
      }

      .table-card {
        background: var(--surface-dark);
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 24px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        border: 1px solid var(--border-dark);
      }

      body[data-theme="light"] .table-card {
        background: var(--surface-light);
        border: 1px solid var(--border-light);
      }

      .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .table-header h2 {
        font-size: 20px;
        font-weight: 700;
        color: var(--text-dark);
      }

      body[data-theme="light"] .table-header h2 {
        color: var(--text-light);
      }

      .table-actions {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .search-box {
        position: relative;
        display: flex;
        align-items: center;
      }

      .search-box i {
        position: absolute;
        left: 10px;
        color: var(--text-secondary-dark);
        font-size: 14px;
      }

      body[data-theme="light"] .search-box i {
        color: var(--text-secondary-light);
      }

      .search-box input {
        padding: 8px 12px 8px 32px;
        border: 1px solid var(--border-dark);
        border-radius: var(--border-radius);
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-dark);
        font-size: 14px;
        width: 200px;
        transition: var(--transition);
      }

      body[data-theme="light"] .search-box input {
        border: 1px solid var(--border-light);
        background: var(--surface-light);
        color: var(--text-light);
      }

      .search-box input:focus {
        outline: none;
        border-color: var(--primary-dark);
        box-shadow: 0 0 0 3px rgba(137, 6, 230, 0.2);
      }

      body[data-theme="light"] .search-box input:focus {
        border-color: var(--primary-light);
      }

      .table-responsive {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid var(--border-dark);
        font-size: 14px;
      }

      body[data-theme="light"] th,
      body[data-theme="light"] td {
        border-bottom: 1px solid var(--border-light);
      }

      th {
        font-weight: 600;
        color: var(--text-dark);
      }

      body[data-theme="light"] th {
        color: var(--text-light);
      }

      .request-type {
        font-weight: 500;
        color: var(--text-dark);
      }

      body[data-theme="light"] .request-type {
        color: var(--text-light);
      }

      .badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 500;
      }

      .badge-pending {
        background: rgba(255, 159, 10, 0.2);
        color: var(--warning-light);
      }

      .badge-progress {
        background: rgba(137, 6, 230, 0.2);
        color: var(--primary-dark);
      }

      body[data-theme="light"] .badge-progress {
        color: var(--primary-light);
      }

      .badge-completed {
        background: rgba(48, 209, 88, 0.2);
        color: var(--success-light);
      }

      .actions {
        display: flex;
        gap: 8px;
      }

      .btn-icon {
        background: transparent;
        border: none;
        color: var(--text-secondary-dark);
        cursor: pointer;
        font-size: 16px;
        padding: 6px;
        border-radius: 50%;
        transition: var(--transition);
      }

      body[data-theme="light"] .btn-icon {
        color: var(--text-secondary-light);
      }

      .btn-icon:hover {
        background: rgba(137, 6, 230, 0.1);
        color: var(--primary-dark);
      }

      body[data-theme="light"] .btn-icon:hover {
        color: var(--primary-light);
      }

      .empty-state {
        text-align: center;
        padding: 40px;
        color: var(--text-secondary-dark);
      }

      body[data-theme="light"] .empty-state {
        color: var(--text-secondary-light);
      }

      .empty-state i {
        font-size: 24px;
        margin-bottom: 8px;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .modal-content {
        background: var(--surface-dark);
        border-radius: var(--border-radius);
        width: 90%;
        max-width: 500px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border: 1px solid var(--border-dark);
      }

      body[data-theme="light"] .modal-content {
        background: var(--surface-light);
        border: 1px solid var(--border-light);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 20px;
        border-bottom: 1px solid var(--border-dark);
      }

      body[data-theme="light"] .modal-header {
        border-bottom: 1px solid var(--border-light);
      }

      .modal-header h3 {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-dark);
      }

      body[data-theme="light"] .modal-header h3 {
        color: var(--text-light);
      }

      .modal-header .close {
        background: transparent;
        border: none;
        font-size: 20px;
        color: var(--text-secondary-dark);
        cursor: pointer;
        transition: var(--transition);
      }

      body[data-theme="light"] .modal-header .close {
        color: var(--text-secondary-light);
      }

      .modal-header .close:hover {
        color: var(--primary-dark);
      }

      body[data-theme="light"] .modal-header .close:hover {
        color: var(--primary-light);
      }

      .modal-body {
        padding: 20px;
        color: var(--text-dark);
        font-size: 14px;
      }

      body[data-theme="light"] .modal-body {
        color: var(--text-light);
      }

      .modal-body p {
        margin-bottom: 12px;
      }

      .modal-footer {
        padding: 16px 20px;
        border-top: 1px solid var(--border-dark);
        text-align: right;
      }

      body[data-theme="light"] .modal-footer {
        border-top: 1px solid var(--border-light);
      }

      .btn-cancel {
        background: var(--danger-light);
        color: var(--text-dark);
        border: none;
        padding: 10px 16px;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: var(--transition);
      }

      body[data-theme="light"] .btn-cancel {
        color: var(--text-light);
      }

      .btn-cancel:hover {
        background: #d70015;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(255, 69, 58, 0.3);
      }

      .charts-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 20px;
        margin-bottom: 24px;
      }

      .chart-card {
        background: var(--surface-dark);
        border-radius: var(--border-radius);
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        border: 1px solid var(--border-dark);
        transition: var(--transition);
      }

      body[data-theme="light"] .chart-card {
        background: var(--surface-light);
        border: 1px solid var(--border-light);
      }

      .chart-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .chart-header h3 {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-dark);
      }

      body[data-theme="light"] .chart-header h3 {
        color: var(--text-light);
      }

      .chart-filter {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid var(--border-dark);
        color: var(--text-dark);
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        cursor: pointer;
        transition: var(--transition);
      }

      body[data-theme="light"] .chart-filter {
        border: 1px solid var(--border-light);
        background: var(--surface-light);
        color: var(--text-light);
      }

      .chart-filter option {
        background: var(--surface-dark);
        color: var(--text-dark);
      }

      body[data-theme="light"] .chart-filter option {
        background: var(--surface-light);
        color: var(--text-light);
      }

      .chart-filter:hover {
        background: rgba(137, 6, 230, 0.15);
      }

      .chart-container {
        position: relative;
        height: 220px;
        width: 100%;
      }

      .theme-toggle {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary-dark);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        z-index: 100;
        transition: var(--transition);
      }

      body[data-theme="light"] .theme-toggle {
        background: var(--primary-light);
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }

      @media (max-width: 1200px) {
        .charts-section {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 992px) {
        .dashboard-container {
          flex-direction: column;
        }

        .sidebar {
          width: 100%;
          border-right: none;
          border-bottom: 1px solid var(--border-dark);
        }

        body[data-theme="light"] .sidebar {
          border-bottom: 1px solid var(--border-light);
        }

        .nav-menu {
          display: flex;
          overflow-x: auto;
          padding: 0 12px 12px;
        }

        .nav-item {
          flex-shrink: 0;
        }

        .nav-link {
          padding: 10px 14px;
        }

        .main-content {
          padding: 20px;
        }
      }

      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          align-items: flex-start;
          gap: 12px;
        }

        .btn-group {
          width: 100%;
          justify-content: space-between;
        }

        .stats-cards {
          grid-template-columns: 1fr;
        }

        .welcome-banner {
          padding: 20px;
        }

        .welcome-banner h2 {
          font-size: 20px;
        }

        .header h1 {
          font-size: 24px;
        }

        .chart-card,
        .form-card,
        .table-card {
          padding: 16px;
        }

        .form-row {
          flex-direction: column;
        }

        .form-group {
          min-width: 100%;
        }
      }

      @media (max-width: 576px) {
        .main-content {
          padding: 16px;
        }

        .header h1 {
          font-size: 20px;
        }

        .stat-card {
          flex-direction: column;
          text-align: center;
          padding: 16px;
        }

        .welcome-banner::before {
          display: none;
        }

        th,
        td {
          font-size: 12px;
          padding: 8px;
        }

        .actions {
          flex-direction: column;
          gap: 4px;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .stat-card,
      .form-card,
      .table-card,
      .welcome-banner,
      .chart-card {
        animation: fadeIn 0.5s ease-out forwards;
      }

      .stat-card:nth-child(2) {
        animation-delay: 0.1s;
      }
      .stat-card:nth-child(3) {
        animation-delay: 0.2s;
      }
    </style>
  </head>
  <body data-theme="dark">
    <div class="dashboard-container">
      <aside class="sidebar">
        <div class="sidebar-header">
          <img src="logo1.png" alt="Solution Tecnologia Logo" class="logo" />
          <h2> Solution Tecnologia</h2>
        </div>

        <div class="user-info">
          <p>Bem-vindo, <strong id="username">Usuário</strong></p>
          <p><span class="role-badge" id="userrole">Usuário</span></p>
        </div>

        <ul class="nav-menu">
          <li class="nav-item">
            <a href="dashboard-user.html" class="nav-link">
              <i class="fas fa-home"></i>
              <span>Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="itilusuario.html" class="nav-link">
              <i class="fas fa-tasks"></i>
              <span>Meus Chamados</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="lgpd-user.html" class="nav-link active">
              <i class="fas fa-shield-alt"></i>
              <span>LGPD - Requisições</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="support.html" class="nav-link">
              <i class="fas fa-headset"></i>
              <span>Suporte</span>
            </a>
          </li>
        </ul>

        <div class="sidebar-footer">Speedpro Faculdade &copy; 2025</div>
      </aside>

      <main class="main-content">
        <div class="header">
          <h1>
            <i class="fas fa-shield-alt"></i> Módulo LGPD - Minhas Requisições
          </h1>
          <div class="btn-group">
            <a
              href="dashboard-user.html"
              class="back-btn"
              aria-label="Voltar ao Dashboard"
            >
              <i class="fas fa-arrow-left"></i> Voltar
            </a>
          <button class="logout-btn" onclick="window.location.href='../../login.html'" aria-label="Sair">
            <i class="fas fa-sign-out-alt"></i> Sair
          </button>
          </div>
        </div>

        <div class="welcome-banner">
          <h2>Gerencie Suas Requisições LGPD</h2>
          <p>
            Crie, acompanhe e visualize o status das suas solicitações de
            proteção de dados. Acompanhe métricas detalhadas sobre suas requisições.
          </p>
        </div>

        <div class="stats-cards">
          <div class="stat-card">
            <div class="stat-icon stat-pending">
              <i class="fas fa-clock"></i>
            </div>
            <div class="stat-info">
              <h3 id="pending-requests">0</h3>
              <p>Pendentes</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon stat-progress">
              <i class="fas fa-spinner"></i>
            </div>
            <div class="stat-info">
              <h3 id="progress-requests">0</h3>
              <p>Em Andamento</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon stat-completed">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-info">
              <h3 id="completed-requests">0</h3>
              <p>Concluídas</p>
            </div>
          </div>
        </div>

        <div class="charts-section">
          <div class="chart-card">
            <div class="chart-header">
              <h3>Distribuição de Status</h3>
              <select
                class="chart-filter"
                id="status-filter"
                aria-label="Filtro de Status"
              >
                <option value="week">Esta Semana</option>
                <option value="month" selected>Este Mês</option>
                <option value="all">Todos</option>
              </select>
            </div>
            <div class="chart-container">
              <canvas
                id="status-chart"
                role="img"
                aria-label="Gráfico de Distribuição de Status das Requisições"
              ></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <h3>Distribuição por Tipo de Requisição</h3>
              <select
                class="chart-filter"
                id="type-filter"
                aria-label="Filtro de Tipo"
              >
                <option value="week">Esta Semana</option>
                <option value="month" selected>Este Mês</option>
                <option value="all">Todos</option>
              </select>
            </div>
            <div class="chart-container">
              <canvas
                id="type-chart"
                role="img"
                aria-label="Gráfico de Distribuição por Tipo de Requisições"
              ></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <h3>Evolução Mensal de Requisições</h3>
              <select
                class="chart-filter"
                id="timeline-filter"
                aria-label="Filtro de Timeline"
              >
                <option value="3months" selected>Últimos 3 Meses</option>
                <option value="6months">Últimos 6 Meses</option>
                <option value="year">Último Ano</option>
              </select>
            </div>
            <div class="chart-container">
              <canvas
                id="timeline-chart"
                role="img"
                aria-label="Gráfico de Evolução Mensal de Requisições"
              ></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <h3>Tempo Médio de Resolução</h3>
              <select
                class="chart-filter"
                id="resolution-filter"
                aria-label="Filtro de Resolução"
              >
                <option value="week">Esta Semana</option>
                <option value="month" selected>Este Mês</option>
                <option value="all">Todos</option>
              </select>
            </div>
            <div class="chart-container">
              <canvas
                id="resolution-chart"
                role="img"
                aria-label="Gráfico de Tempo Médio de Resolução"
              ></canvas>
            </div>
          </div>
        </div>

        <div class="form-card">
          <h2>Nova Requisição LGPD</h2>
          <form id="request-form">
            <div class="form-row">
              <div class="form-group">
                <label for="requester-name">Nome do Solicitante *</label>
                <input
                  type="text"
                  id="requester-name"
                  class="form-control"
                  placeholder="Ex: João Silva"
                  required
                  readonly
                />
              </div>
              <div class="form-group">
                <label for="requester-email">E-mail do Solicitante *</label>
                <input
                  type="email"
                  id="requester-email"
                  class="form-control"
                  placeholder="exemplo@email.com"
                  required
                  readonly
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="request-type">Tipo de Solicitação *</label>
                <select id="request-type" class="form-control" required>
                  <option value="" disabled selected>Selecione o tipo</option>
                  <option value="Acesso">Acesso aos dados</option>
                  <option value="Correção">Correção de dados</option>
                  <option value="Exclusão">Exclusão de dados</option>
                  <option value="Portabilidade">Portabilidade de dados</option>
                  <option value="Revogação">Revogação de consentimento</option>
                </select>
              </div>
              <div class="form-group">
                <label for="request-priority">Prioridade *</label>
                <select id="request-priority" class="form-control" required>
                  <option value="Baixa">Baixa</option>
                  <option value="Média" selected>Média</option>
                  <option value="Alta">Alta</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="request-description"
                >Descrição da Solicitação *</label
              >
              <textarea
                id="request-description"
                class="form-control"
                rows="4"
                placeholder="Descreva detalhadamente a solicitação..."
                required
              ></textarea>
            </div>
            <button
              type="submit"
              class="btn-primary"
              aria-label="Criar Solicitação"
            >
              <i class="fas fa-plus"></i> Criar Solicitação
            </button>
          </form>
        </div>

        <div class="table-card">
          <div class="table-header">
            <h2>Minhas Requisições LGPD</h2>
            <div class="table-actions">
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input
                  type="text"
                  id="search-input"
                  placeholder="Buscar requisição..."
                  aria-label="Buscar requisições"
                />
              </div>
            </div>
          </div>
          <div class="table-responsive">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Tipo</th>
                  <th>Status</th>
                  <th>Prioridade</th>
                  <th>Data</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="requests-table"></tbody>
            </table>
          </div>
        </div>
      </main>
    </div>

    <div class="modal" id="detailsModal" role="dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Detalhes da Requisição</h3>
          <button class="close" id="closeDetails" aria-label="Fechar Modal">
            &times;
          </button>
        </div>
        <div class="modal-body" id="detailsContent"></div>
        <div class="modal-footer">
          <button class="btn-cancel" id="closeDetailsBtn" aria-label="Fechar">
            Fechar
          </button>
        </div>
      </div>
    </div>

    <div
      class="theme-toggle"
      id="theme-toggle"
      role="button"
      aria-label="Alternar Tema"
    >
      <i class="fas fa-sun"></i>
    </div>

    <script>
      let requests = JSON.parse(localStorage.getItem('requests')) || [];
      let statusChart, typeChart, timelineChart, resolutionChart;

      function initializeData() {
        if (!localStorage.getItem('requests')) {
          const sampleRequests = [
            {
              id: "REQ-0001",
              requesterName: "Usuário",
              requesterEmail: "usuario@faculdade.edu",
              type: "Acesso",
              status: "Pendente",
              priority: "Média",
              description: "Solicito acesso aos meus dados pessoais armazenados.",
              date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
              history: [{ type: "create", text: "Requisição criada", date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString() }]
            },
            {
              id: "REQ-0002",
              requesterName: "Usuário",
              requesterEmail: "usuario@faculdade.edu",
              type: "Correção",
              status: "Em Andamento",
              priority: "Alta",
              description: "Correção de endereço no cadastro.",
              date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
              history: [
                { type: "create", text: "Requisição criada", date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString() },
                { type: "update", text: "Em análise pelo DPO", date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString() }
              ]
            },
            {
              id: "REQ-0003",
              requesterName: "Usuário",
              requesterEmail: "usuario@faculdade.edu",
              type: "Exclusão",
              status: "Concluído",
              priority: "Baixa",
              description: "Solicito exclusão de dados pessoais.",
              date: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
              resolution: "Dados excluídos conforme solicitado.",
              history: [
                { type: "create", text: "Requisição criada", date: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString() },
                { type: "resolve", text: "Requisição concluída", date: new Date(Date.now() - 8 * 24 * 60 * 60 * 1000).toISOString() }
              ]
            },
            {
              id: "REQ-0004",
              requesterName: "Usuário",
              requesterEmail: "usuario@faculdade.edu",
              type: "Portabilidade",
              status: "Pendente",
              priority: "Média",
              description: "Solicito portabilidade dos dados para outro serviço.",
              date: new Date(Date.now() - 4 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
              history: [{ type: "create", text: "Requisição criada", date: new Date(Date.now() - 4 * 24 * 60 * 60 * 1000).toISOString() }]
            },
            {
              id: "REQ-0005",
              requesterName: "Usuário",
              requesterEmail: "usuario@faculdade.edu",
              type: "Revogação",
              status: "Em Andamento",
              priority: "Alta",
              description: "Revogação de consentimento para uso de dados.",
              date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
              history: [
                { type: "create", text: "Requisição criada", date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString() },
                { type: "update", text: "Em análise", date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString() }
              ]
            }
          ];
          localStorage.setItem('requests', JSON.stringify(sampleRequests));
          requests = sampleRequests;
        }
      }

      function generateId() {
        return 'REQ-' + String(requests.length + 1).padStart(4, '0');
      }

      function formatDate(date) {
        const d = new Date(date);
        return `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${d.getFullYear()}`;
      }

      function formatDateTime(date) {
        const d = new Date(date);
        return `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${d.getFullYear()} ${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}`;
      }

      function updateStats() {
        const user = JSON.parse(localStorage.getItem('user')) || { email: 'usuario@faculdade.edu' };
        const userRequests = requests.filter(r => r.requesterEmail === user.email);
        const pending = userRequests.filter(r => r.status === 'Pendente').length;
        const progress = userRequests.filter(r => r.status === 'Em Andamento').length;
        const completed = userRequests.filter(r => r.status === 'Concluído').length;

        document.getElementById('pending-requests').textContent = pending;
        document.getElementById('progress-requests').textContent = progress;
        document.getElementById('completed-requests').textContent = completed;
      }

      function createStatusChart() {
        const user = JSON.parse(localStorage.getItem('user')) || { email: 'usuario@faculdade.edu' };
        const filteredRequests = requests.filter(r => r.requesterEmail === user.email);
        const statusFilter = document.getElementById('status-filter').value;

        const now = new Date();
        const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        const oneMonthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);

        const filterByTime = (items, filter) => {
          if (filter === 'week') return items.filter(item => new Date(item.date) >= oneWeekAgo);
          if (filter === 'month') return items.filter(item => new Date(item.date) >= oneMonthAgo);
          return items;
        };

        const statusData = {
          labels: ['Pendente', 'Em Andamento', 'Concluído'],
          datasets: [{
            data: [
              filterByTime(filteredRequests, statusFilter).filter(r => r.status === 'Pendente').length,
              filterByTime(filteredRequests, statusFilter).filter(r => r.status === 'Em Andamento').length,
              filterByTime(filteredRequests, statusFilter).filter(r => r.status === 'Concluído').length
            ],
            backgroundColor: ['#FF9F0A', '#050DEB', '#30D158'],
            borderWidth: 0,
            hoverOffset: 10
          }]
        };

        const chartOptions = {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--text-dark').trim(),
                font: { size: 12 },
                padding: 20
              }
            },
            tooltip: {
              callbacks: {
                label: context => `${context.label}: ${context.raw} requisições`
              }
            }
          },
          animation: {
            animateScale: true,
            animateRotate: true
          }
        };

        const statusCtx = document.getElementById('status-chart').getContext('2d');
        if (statusChart) statusChart.destroy();
        statusChart = new Chart(statusCtx, { type: 'pie', data: statusData, options: chartOptions });
      }

      function createTypeChart() {
        const user = JSON.parse(localStorage.getItem('user')) || { email: 'usuario@faculdade.edu' };
        const filteredRequests = requests.filter(r => r.requesterEmail === user.email);
        const typeFilter = document.getElementById('type-filter').value;

        const now = new Date();
        const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        const oneMonthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);

        const filterByTime = (items, filter) => {
          if (filter === 'week') return items.filter(item => new Date(item.date) >= oneWeekAgo);
          if (filter === 'month') return items.filter(item => new Date(item.date) >= oneMonthAgo);
          return items;
        };

        const typeData = {
          labels: ['Acesso', 'Correção', 'Exclusão', 'Portabilidade', 'Revogação'],
          datasets: [{
            label: 'Requisições',
            data: [
              filterByTime(filteredRequests, typeFilter).filter(r => r.type === 'Acesso').length,
              filterByTime(filteredRequests, typeFilter).filter(r => r.type === 'Correção').length,
              filterByTime(filteredRequests, typeFilter).filter(r => r.type === 'Exclusão').length,
              filterByTime(filteredRequests, typeFilter).filter(r => r.type === 'Portabilidade').length,
              filterByTime(filteredRequests, typeFilter).filter(r => r.type === 'Revogação').length
            ],
            backgroundColor: ['#FF9F0A', '#050DEB', '#30D158', '#FF00E2', '#FF453A'],
            borderColor: ['#FF9F0A', '#050DEB', '#30D158', '#FF00E2', '#FF453A'],
            borderWidth: 1
          }]
        };

        const chartOptions = {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--text-dark').trim(),
                stepSize: 1
              },
              grid: { color: getComputedStyle(document.documentElement).getPropertyValue('--border-dark').trim() }
            },
            x: {
              ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-dark').trim() },
              grid: { display: false }
            }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: context => `${context.label}: ${context.raw} requisições`
              }
            }
          }
        };

        const typeCtx = document.getElementById('type-chart').getContext('2d');
        if (typeChart) typeChart.destroy();
        typeChart = new Chart(typeCtx, { type: 'bar', data: typeData, options: chartOptions });
      }

      function createTimelineChart() {
        const user = JSON.parse(localStorage.getItem('user')) || { email: 'usuario@faculdade.edu' };
        const filteredRequests = requests.filter(r => r.requesterEmail === user.email);
        const timelineFilter = document.getElementById('timeline-filter').value;

        const now = new Date();
        let monthsToShow = 3;
        if (timelineFilter === '6months') monthsToShow = 6;
        if (timelineFilter === 'year') monthsToShow = 12;

        const months = [];
        const monthData = [];
        
        for (let i = monthsToShow - 1; i >= 0; i--) {
          const date = new Date();
          date.setMonth(now.getMonth() - i);
          const monthName = date.toLocaleString('pt-BR', { month: 'short' });
          months.push(monthName);
          
          const monthStart = new Date(date.getFullYear(), date.getMonth(), 1);
          const monthEnd = new Date(date.getFullYear(), date.getMonth() + 1, 0);
          
          const monthRequests = filteredRequests.filter(r => {
            const requestDate = new Date(r.date);
            return requestDate >= monthStart && requestDate <= monthEnd;
          });
          
          monthData.push(monthRequests.length);
        }

        const timelineData = {
          labels: months,
          datasets: [{
            label: 'Requisições',
            data: monthData,
            backgroundColor: 'rgba(137, 6, 230, 0.2)',
            borderColor: '#8906e6',
            borderWidth: 2,
            tension: 0.4,
            fill: true
          }]
        };

        const chartOptions = {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--text-dark').trim(),
                stepSize: 1
              },
              grid: { color: getComputedStyle(document.documentElement).getPropertyValue('--border-dark').trim() }
            },
            x: {
              ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-dark').trim() },
              grid: { display: false }
            }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: context => `${context.raw} requisições`
              }
            }
          }
        };

        const timelineCtx = document.getElementById('timeline-chart').getContext('2d');
        if (timelineChart) timelineChart.destroy();
        timelineChart = new Chart(timelineCtx, { type: 'line', data: timelineData, options: chartOptions });
      }

      function createResolutionChart() {
        const user = JSON.parse(localStorage.getItem('user')) || { email: 'usuario@faculdade.edu' };
        const filteredRequests = requests.filter(r => r.requesterEmail === user.email);
        const resolutionFilter = document.getElementById('resolution-filter').value;

        const now = new Date();
        const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        const oneMonthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);

        const filterByTime = (items, filter) => {
          if (filter === 'week') return items.filter(item => new Date(item.date) >= oneWeekAgo);
          if (filter === 'month') return items.filter(item => new Date(item.date) >= oneMonthAgo);
          return items;
        };

        const completedRequests = filterByTime(filteredRequests, resolutionFilter).filter(r => r.status === 'Concluído');
        
        // Dados fictícios para o gráfico de resolução
        const resolutionData = {
          labels: ['Acesso', 'Correção', 'Exclusão', 'Portabilidade', 'Revogação'],
          datasets: [{
            label: 'Dias para Resolução',
            data: [5, 7, 3, 10, 6], // Dados fictícios
            backgroundColor: ['#FF9F0A', '#050DEB', '#30D158', '#FF00E2', '#FF453A'],
            borderColor: ['#FF9F0A', '#050DEB', '#30D158', '#FF00E2', '#FF453A'],
            borderWidth: 1
          }]
        };

        const chartOptions = {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--text-dark').trim(),
                stepSize: 1
              },
              grid: { color: getComputedStyle(document.documentElement).getPropertyValue('--border-dark').trim() }
            },
            x: {
              ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-dark').trim() },
              grid: { display: false }
            }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: context => `${context.raw} dias em média`
              }
            }
          }
        };

        const resolutionCtx = document.getElementById('resolution-chart').getContext('2d');
        if (resolutionChart) resolutionChart.destroy();
        resolutionChart = new Chart(resolutionCtx, { type: 'bar', data: resolutionData, options: chartOptions });
      }

      function renderRequests() {
        const user = JSON.parse(localStorage.getItem('user')) || { email: 'usuario@faculdade.edu' };
        const tableBody = document.getElementById('requests-table');
        const searchTerm = document.getElementById('search-input').value.toLowerCase();

        let filteredRequests = requests.filter(r => r.requesterEmail === user.email && (
          r.id.toLowerCase().includes(searchTerm) ||
          r.type.toLowerCase().includes(searchTerm) ||
          (r.description && r.description.toLowerCase().includes(searchTerm))
        ));

        if (filteredRequests.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="6" class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>Nenhuma requisição encontrada</p>
              </td>
            </tr>
          `;
          return;
        }

        tableBody.innerHTML = filteredRequests.map(request => {
          let badgeClass = request.status === 'Pendente' ? 'badge-pending' :
                          request.status === 'Em Andamento' ? 'badge-progress' : 'badge-completed';
          return `
            <tr>
              <td>${request.id}</td>
              <td><span class="request-type">${request.type}</span></td>
              <td><span class="badge ${badgeClass}">${request.status}</span></td>
              <td>${request.priority}</td>
              <td>${formatDate(request.date)}</td>
              <td class="actions">
                <button class="btn-icon btn-details" title="Ver Detalhes" data-id="${request.id}" aria-label="Ver detalhes da requisição ${request.id}">
                  <i class="fas fa-eye"></i>
                </button>
              </td>
            </tr>
          `;
        }).join('');

        document.querySelectorAll('.btn-details').forEach(button => {
          button.addEventListener('click', (e) => {
            const requestId = e.currentTarget.getAttribute('data-id');
            showDetailsModal(requestId);
          });
        });
      }

      function showDetailsModal(id) {
        const request = requests.find(r => r.id === id);
        if (!request) return;

        document.getElementById('detailsContent').innerHTML = `
          <p><strong>ID:</strong> ${request.id}</p>
          <p><strong>Solicitante:</strong> ${request.requesterName}</p>
          <p><strong>E-mail:</strong> ${request.requesterEmail}</p>
          <p><strong>Tipo:</strong> ${request.type}</p>
          <p><strong>Status:</strong> ${request.status}</p>
          <p><strong>Prioridade:</strong> ${request.priority || 'Média'}</p>
          ${request.deadline ? `<p><strong>Prazo Legal:</strong> ${formatDate(request.deadline)}</p>` : ''}
          <p><strong>Data de Criação:</strong> ${formatDate(request.date)}</p>
          <p><strong>Descrição:</strong> ${request.description || 'Nenhuma descrição'}</p>
          ${request.resolution ? `<p><strong>Resolução:</strong> ${request.resolution}</p>` : ''}
          ${request.history && request.history.length > 0 ? `
          <div style="margin-top: 20px; border-top: 1px solid var(--border-dark); padding-top: 15px;">
            <h4 style="margin-bottom: 10px; color: var(--text-dark);">Histórico de Alterações</h4>
            ${request.history.map(item => `
              <p style="font-size: 13px; color: var(--text-secondary-dark); margin-bottom: 5px;">
                <i class="fas fa-clock" style="margin-right: 5px;"></i>
                ${formatDateTime(item.date)} - ${item.text}
              </p>
            `).join('')}
          </div>
          ` : ''}
        `;
        document.getElementById('detailsModal').style.display = 'flex';
        document.getElementById('detailsModal').focus();
      }

      function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
      }

      document.getElementById('request-form').addEventListener('submit', function(e) {
        e.preventDefault();

        const user = JSON.parse(localStorage.getItem('user')) || { username: 'Usuário', email: 'usuario@faculdade.edu' };
        const id = generateId();
        const requesterName = document.getElementById('requester-name').value;
        const requesterEmail = document.getElementById('requester-email').value;
        const type = document.getElementById('request-type').value;
        const priority = document.getElementById('request-priority').value;
        const description = document.getElementById('request-description').value;
        const date = new Date().toISOString().split('T')[0];
        const now = new Date().toISOString();

        const request = {
          id,
          requesterName,
          requesterEmail,
          type,
          status: 'Pendente',
          priority,
          description,
          date,
          history: [{ type: 'create', text: 'Requisição criada', date: now }]
        };

        requests.push(request);
        localStorage.setItem('requests', JSON.stringify(requests));
        alert('Requisição criada com sucesso!');
        document.getElementById('request-form').reset();
        document.getElementById('request-type').value = ''; // Reset select to default
        document.getElementById('request-priority').value = 'Média'; // Reset priority to default
        document.getElementById('requester-name').value = user.username;
        document.getElementById('requester-email').value = user.email;
        renderRequests();
        updateStats();
        createStatusChart();
        createTypeChart();
        createTimelineChart();
        createResolutionChart();
      });

      document.getElementById('closeDetails').addEventListener('click', () => closeModal('detailsModal'));
      document.getElementById('closeDetailsBtn').addEventListener('click', () => closeModal('detailsModal'));

      window.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal')) {
          closeModal(e.target.id);
        }
      });

      window.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeModal('detailsModal');
        }
      });

      document.getElementById('search-input').addEventListener('input', () => {
        renderRequests();
        createStatusChart();
        createTypeChart();
      });

      function toggleTheme() {
        const body = document.body;
        const currentTheme = body.getAttribute('data-theme');
        const themeToggle = document.getElementById('theme-toggle');

        if (currentTheme === 'light') {
          body.setAttribute('data-theme', 'dark');
          themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
          localStorage.setItem('theme', 'dark');
        } else {
          body.setAttribute('data-theme', 'light');
          themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
          localStorage.setItem('theme', 'light');
        }
        if (statusChart) statusChart.update();
        if (typeChart) typeChart.update();
        if (timelineChart) timelineChart.update();
        if (resolutionChart) resolutionChart.update();
      }

      function logout() {
        if (confirm('Tem certeza que deseja sair?')) {
          localStorage.removeItem('user');
          alert('Logout realizado com sucesso!');
          window.location.href = 'login.html';
        }
      }

      document.addEventListener('DOMContentLoaded', function() {
        initializeData();

        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.body.setAttribute('data-theme', savedTheme);
        document.getElementById('theme-toggle').innerHTML = savedTheme === 'light' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';

        const user = JSON.parse(localStorage.getItem('user')) || { username: 'Usuário', role: 'Usuário', type: 'user', email: 'usuario@faculdade.edu' };
        document.getElementById('username').textContent = user.username;
        document.getElementById('userrole').textContent = user.role;
        document.getElementById('requester-name').value = user.username;
        document.getElementById('requester-email').value = user.email;

        if (user.type !== 'user') {
          alert('Acesso não autorizado. Redirecionando para login.');
          logout();
          return;
        }

        updateStats();
        renderRequests();
        createStatusChart();
        createTypeChart();
        createTimelineChart();
        createResolutionChart();

        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
        document.getElementById('status-filter').addEventListener('change', createStatusChart);
        document.getElementById('type-filter').addEventListener('change', createTypeChart);
        document.getElementById('timeline-filter').addEventListener('change', createTimelineChart);
        document.getElementById('resolution-filter').addEventListener('change', createResolutionChart);
      });
    </script>
  </body>
</html>