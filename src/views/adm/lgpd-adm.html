<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ITIL Administrador | Solution Tecnologia</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
:root {
  --primary-light: #8906E6; /* Roxo */
  --primary-dark: #050DEB; /* Azul */
  --secondary-light: #FF00E2; /* Rosa */
  --accent-light: #FF9F0A;
  --success-light: #30D158;
  --danger-light: #FF453A;
  --warning-light: #FF9F0A;
  --text-light: #1C1C1E;
  --text-secondary-light: #636366;
  --background-light: #F5F5F7;
  --surface-light: #FFFFFF;
  --border-light: #E5E5EA;

  --primary-dark-dark: #FF00E2; /* Rosa */
  --secondary-dark: #050DEB; /* Azul */
  --accent-dark: #FF9F0A;
  --success-dark: #30D158;
  --danger-dark: #FF453A;
  --warning-dark: #FF9F0A;
  --text-dark: #FFFFFF; /* Texto branco no tema escuro */
  --text-secondary-dark: #A1A1A6; /* Texto secundário claro */
  --background-dark: #121212; /* Fundo escuro suave */
  --surface-dark: #1E1E1E; /* Superfície mais clara que o fundo */
  --border-dark: #2C2C2E; /* Borda escura suave */

  --border-radius: 12px;
  --sidebar-width: 240px;
  --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', sans-serif;
}

body {
  background-color: var(--background-dark);
  color: var(--text-dark); /* Texto branco por padrão no tema escuro */
  line-height: 1.6;
  font-weight: 400;
  -webkit-font-smoothing: antialiased;
  transition: background-color 0.3s ease;
}

body[data-theme="light"] {
  background-color: var(--background-light);
  color: var(--text-light);
}

.container {
  display: flex;
  min-height: 100vh;
}

.sidebar {
  width: var(--sidebar-width);
  background: var(--surface-dark);
  color: var(--text-dark);
  padding: 0;
  transition: var(--transition);
  border-right: 1px solid var(--border-dark);
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
}

body[data-theme="light"] .sidebar {
  background: var(--surface-light);
  color: var(--text-light);
  border-right: 1px solid var(--border-light);
}

.sidebar-header {
  padding: 24px 20px;
  border-bottom: 1px solid var(--border-dark);
  text-align: center;
}

body[data-theme="light"] .sidebar-header {
  border-bottom: 1px solid var(--border-light);
}

.sidebar-header img.logo {
  width: 80px;
  height: auto;
  margin-bottom: 8px;
}

.sidebar-header h2 {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  font-size: 20px;
  font-weight: 700;
  color: var(--text-dark);
}

body[data-theme="light"] .sidebar-header h2 {
  color: var(--text-light);
}

.sidebar-header h2 i {
  color: var(--primary-dark);
  background: rgba(137, 6, 230, 0.15);
  width: 36px;
  height: 36px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
}

body[data-theme="light"] .sidebar-header h2 i {
  color: var(--primary-light);
}

.user-info {
  padding: 20px;
  margin-bottom: 0;
  border-bottom: 1px solid var(--border-dark);
}

body[data-theme="light"] .user-info {
  border-bottom: 1px solid var(--border-light);
}

.user-info p {
  margin-bottom: 6px;
  font-size: 14px;
  color: var(--text-secondary-dark);
}

body[data-theme="light"] .user-info p {
  color: var(--text-secondary-light);
}

.user-info .role-badge {
  display: inline-block;
  background: var(--primary-dark);
  color: #FFFFFF;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
  margin-top: 6px;
}

body[data-theme="light"] .user-info .role-badge {
  background: var(--primary-light);
  color: var(--text-light);
}

.nav-menu {
  list-style: none;
  padding: 12px;
  flex-grow: 1;
}

.nav-item {
  margin-bottom: 4px;
}

.nav-link {
  display: flex;
  align-items: center;
  padding: 12px 14px;
  color: var(--text-secondary-dark);
  text-decoration: none;
  transition: var(--transition);
  gap: 10px;
  border-radius: var(--border-radius);
  font-size: 14px;
  font-weight: 500;
  position: relative;
}

body[data-theme="light"] .nav-link {
  color: var(--text-secondary-light);
}

.nav-link:hover {
  background: rgba(137, 6, 230, 0.15);
  color: var(--text-dark); /* Branco no hover no tema escuro */
}

body[data-theme="light"] .nav-link:hover {
  color: var(--primary-light);
}

.nav-link.active {
  background: rgba(137, 6, 230, 0.25);
  color: var(--text-dark); /* Branco no estado ativo no tema escuro */
  font-weight: 600;
}

body[data-theme="light"] .nav-link.active {
  color: var(--primary-light);
}

.nav-link.active::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  height: 18px;
  width: 4px;
  background: var(--primary-dark);
  border-radius: 0 2px 2px 0;
}

body[data-theme="light"] .nav-link.active::before {
  background: var(--primary-light);
}

.nav-link i {
  width: 18px;
  text-align: center;
  font-size: 16px;
}

.sidebar-footer {
  padding: 12px;
  border-top: 1px solid var(--border-dark);
  font-size: 11px;
  color: var(--text-secondary-dark);
  text-align: center;
}

body[data-theme="light"] .sidebar-footer {
  border-top: 1px solid var(--border-light);
  color: var(--text-secondary-light);
}

.main-content {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
  background: var(--background-dark);
}

body[data-theme="light"] .main-content {
  background: var(--background-light);
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border-dark);
}

body[data-theme="light"] .header {
  border-bottom: 1px solid var(--border-light);
}

.header h1 {
  color: var(--text-dark); /* Branco no tema escuro */
  font-size: 28px;
  font-weight: 700;
  letter-spacing: -0.5px;
  display: flex;
  align-items: center;
  gap: 12px;
}

body[data-theme="light"] .header h1 {
  color: var(--text-light);
}

.header h1 i {
  color: var(--primary-dark);
}

body[data-theme="light"] .header h1 i {
  color: var(--primary-light);
}

.btn-group {
  display: flex;
  gap: 12px;
}

.back-btn, .logout-btn {
  background: var(--surface-dark);
  color: var(--text-dark); /* Branco no tema escuro */
  border: none;
  padding: 10px 16px;
  border-radius: var(--border-radius);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: var(--transition);
  text-decoration: none;
  font-weight: 500;
  font-size: 14px;
}

body[data-theme="light"] .back-btn {
  background: var(--surface-light);
  color: var(--text-light);
}

.back-btn:hover {
  background: var(--border-dark);
  transform: translateY(-2px);
}

body[data-theme="light"] .back-btn:hover {
  background: var(--border-light);
}

.logout-btn {
  background: var(--danger-light);
  box-shadow: 0 4px 12px rgba(255, 69, 58, 0.2);
}

.logout-btn:hover {
  background: #D70015;
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(255, 69, 58, 0.4);
}

.theme-toggle {
  background: var(--primary-dark);
  color: #FFFFFF;
  border: none;
  padding: 12px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
  width: 40px;
  height: 40px;
}

body[data-theme="light"] .theme-toggle {
  background: var(--primary-light);
}

.theme-toggle:hover {
  transform: scale(1.1);
}

.tabs {
  display: flex;
  flex-wrap: wrap;
  margin-bottom: 24px;
  border-bottom: 1px solid var(--border-dark);
  overflow-x: auto;
}

body[data-theme="light"] .tabs {
  border-bottom: 1px solid var(--border-light);
}

.tab {
  padding: 14px 24px;
  background: transparent;
  border: none;
  color: var(--text-secondary-dark);
  cursor: pointer;
  font-size: 15px;
  font-weight: 500;
  transition: var(--transition);
  position: relative;
  white-space: nowrap;
}

body[data-theme="light"] .tab {
  color: var(--text-secondary-light);
}

.tab:hover {
  color: var(--text-dark); /* Branco no hover no tema escuro */
}

body[data-theme="light"] .tab:hover {
  color: var(--primary-light);
}

.tab.active {
  color: var(--text-dark); /* Branco no estado ativo no tema escuro */
  font-weight: 600;
}

body[data-theme="light"] .tab.active {
  color: var(--primary-light);
}

.tab.active::after {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 0;
  width: 100%;
  height: 3px;
  background: var(--primary-dark);
  border-radius: 3px 3px 0 0;
}

body[data-theme="light"] .tab.active::after {
  background: var(--primary-light);
}

.tab-content {
  display: none;
  animation: fadeIn 0.3s ease;
}

.tab-content.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.stats-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}

.stat-card {
  background: var(--surface-dark);
  padding: 20px;
  border-radius: var(--border-radius);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  display: flex;
  align-items: center;
  gap: 14px;
  border: 1px solid var(--border-dark);
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}

body[data-theme="light"] .stat-card {
  background: var(--surface-light);
  border: 1px solid var(--border-light);
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
}

.stat-card::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: var(--primary-dark);
}

body[data-theme="light"] .stat-card::after {
  background: var(--primary-light);
}

.stat-card:nth-child(2)::after { background: var(--success-light); }
.stat-card:nth-child(3)::after { background: var(--warning-light); }
.stat-card:nth-child(4)::after { background: var(--danger-light); }

.stat-icon {
  width: 50px;
  height: 50px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  color: #FFFFFF;
  transition: transform 0.3s ease;
}

body[data-theme="light"] .stat-icon {
  color: var(--text-light);
}

.stat-card:hover .stat-icon {
  transform: scale(1.1);
}

.stat-open { background: var(--primary-dark); box-shadow: 0 6px 15px rgba(137, 6, 230, 0.3); }
.stat-progress { background: var(--warning-light); box-shadow: 0 6px 15px rgba(255, 159, 10, 0.3); }
.stat-resolved { background: var(--success-light); box-shadow: 0 6px 15px rgba(48, 209, 88, 0.3); }
.stat-total { background: var(--primary-dark); box-shadow: 0 6px 15px rgba(137, 6, 230, 0.3); }
.stat-approved { background: var(--success-light); box-shadow: 0 6px 15px rgba(48, 209, 88, 0.3); }
.stat-pending { background: var(--warning-light); box-shadow: 0 6px 15px rgba(255, 159, 10, 0.3); }
.stat-rejected { background: var(--danger-light); box-shadow: 0 6px 15px rgba(255, 69, 58, 0.3); }

body[data-theme="light"] .stat-open { background: var(--primary-light); }
body[data-theme="light"] .stat-total { background: var(--primary-light); }

.stat-info h3 {
  font-size: 28px;
  font-weight: 800;
  margin-bottom: 6px;
  color: var(--text-dark); /* Branco no tema escuro */
}

body[data-theme="light"] .stat-info h3 {
  color: var(--text-light);
}

.stat-info p {
  color: var(--text-secondary-dark);
  font-size: 14px;
  font-weight: 500;
}

body[data-theme="light"] .stat-info p {
  color: var(--text-secondary-light);
}

.filters-card {
  background: var(--surface-dark);
  border-radius: var(--border-radius);
  padding: 24px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  margin-bottom: 24px;
  border: 1px solid var(--border-dark);
}

body[data-theme="light"] .filters-card {
  background: var(--surface-light);
  border: 1px solid var(--border-light);
}

.filters-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 18px;
}

.filters-title {
  font-size: 20px;
  font-weight: 600;
  color: var(--text-dark); /* Branco no tema escuro */
}

body[data-theme="light"] .filters-title {
  color: var(--text-light);
}

.toggle-filters {
  background: transparent;
  border: none;
  color: var(--primary-dark);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  font-weight: 500;
  font-size: 15px;
}

body[data-theme="light"] .toggle-filters {
  color: var(--primary-light);
}

.filters-content {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 18px;
}

.filter-group {
  margin-bottom: 12px;
}

.filter-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: var(--text-dark); /* Branco no tema escuro */
  font-size: 15px;
}

body[data-theme="light"] .filter-group label {
  color: var(--text-light);
}

.filter-select, .filter-input {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--border-dark);
  border-radius: var(--border-radius);
  font-size: 15px;
  transition: var(--transition);
  background: var(--surface-dark);
  color: var(--text-dark); /* Branco no tema escuro */
}

body[data-theme="light"] .filter-select,
body[data-theme="light"] .filter-input {
  border: 1px solid var(--border-light);
  background: var(--background-light);
  color: var(--text-light);
}

.filter-select:focus, .filter-input:focus {
  outline: none;
  border-color: var(--primary-dark);
  box-shadow: 0 0 0 2px rgba(137, 6, 230, 0.2);
}

body[data-theme="light"] .filter-select:focus,
body[data-theme="light"] .filter-input:focus {
  border-color: var(--primary-light);
}

.form-card {
  background: var(--surface-dark);
  border-radius: var(--border-radius);
  padding: 28px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  margin-bottom: 32px;
  border: 1px solid var(--border-dark);
}

body[data-theme="light"] .form-card {
  background: var(--surface-light);
  border: 1px solid var(--border-light);
}

.form-card h2 {
  margin-bottom: 24px;
  color: var(--text-dark); /* Branco no tema escuro */
  font-size: 24px;
  font-weight: 700;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border-dark);
}

body[data-theme="light"] .form-card h2 {
  color: var(--text-light);
  border-bottom: 1px solid var(--border-light);
}

.form-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 20px;
}

.form-group {
  margin-bottom: 18px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: var(--text-dark); /* Branco no tema escuro */
  font-size: 15px;
}

body[data-theme="light"] .form-group label {
  color: var(--text-light);
}

.form-control {
  width: 100%;
  padding: 14px;
  border: 1px solid var(--border-dark);
  border-radius: var(--border-radius);
  font-size: 15px;
  transition: var(--transition);
  background: var(--surface-dark);
  color: var(--text-dark); /* Branco no tema escuro */
}

body[data-theme="light"] .form-control {
  border: 1px solid var(--border-light);
  background: var(--background-light);
  color: var(--text-light);
}

textarea.form-control {
  min-height: 120px;
  resize: vertical;
}

.form-control:focus {
  outline: none;
  border-color: var(--primary-dark);
  box-shadow: 0 0 0 2px rgba(137, 6, 230, 0.2);
}

body[data-theme="light"] .form-control:focus {
  border-color: var(--primary-light);
}

.btn-primary {
  background: var(--primary-dark);
  color: #FFFFFF;
  border: none;
  padding: 14px 24px;
  border-radius: var(--border-radius);
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 12px rgba(137, 6, 230, 0.25);
}

body[data-theme="light"] .btn-primary {
  background: var(--primary-light);
  color: var(--text-light);
}

.btn-primary:hover {
  background: #7A05CC;
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(137, 6, 230, 0.3);
}

body[data-theme="light"] .btn-primary:hover {
  background: #7A05CC;
}

.table-card {
  background: var(--surface-dark);
  border-radius: var(--border-radius);
  padding: 28px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  border: 1px solid var(--border-dark);
}

body[data-theme="light"] .table-card {
  background: var(--surface-light);
  border: 1px solid var(--border-light);
}

.table-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.table-header h2 {
  color: var(--text-dark); /* Branco no tema escuro */
  font-size: 24px;
  font-weight: 700;
}

body[data-theme="light"] .table-header h2 {
  color: var(--text-light);
}

.table-actions {
  display: flex;
  gap: 12px;
}

.btn-secondary {
  background: var(--surface-dark);
  color: var(--text-dark); /* Branco no tema escuro */
  border: none;
  padding: 10px 16px;
  border-radius: var(--border-radius);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  font-weight: 500;
  font-size: 15px;
  transition: var(--transition);
}

body[data-theme="light"] .btn-secondary {
  background: var(--background-light);
  color: var(--text-light);
}

.btn-secondary:hover {
  background: var(--border-dark);
}

body[data-theme="light"] .btn-secondary:hover {
  background: var(--border-light);
}

.search-box {
  display: flex;
  align-items: center;
  background: var(--surface-dark);
  padding: 10px 16px;
  border-radius: var(--border-radius);
  width: 300px;
  transition: var(--transition);
  border: 1px solid var(--border-dark);
}

body[data-theme="light"] .search-box {
  background: var(--background-light);
  border: 1px solid var(--border-light);
}

.search-box:focus-within {
  border-color: var(--primary-dark);
  box-shadow: 0 0 0 2px rgba(137, 6, 230, 0.2);
}

body[data-theme="light"] .search-box:focus-within {
  border-color: var(--primary-light);
}

.search-box i {
  color: var(--text-secondary-dark);
  margin-right: 10px;
}

body[data-theme="light"] .search-box i {
  color: var(--text-secondary-light);
}

.search-box input {
  border: none;
  background: transparent;
  width: 100%;
  font-size: 15px;
  color: var(--text-dark); /* Branco no tema escuro */
}

body[data-theme="light"] .search-box input {
  color: var(--text-light);
}

.search-box input:focus {
  outline: none;
}

table {
  width: 100%;
  border-collapse: collapse;
}

thead {
  background: var(--surface-dark);
}

body[data-theme="light"] thead {
  background: var(--background-light);
}

th, td {
  padding: 14px 16px;
  text-align: left;
  border-bottom: 1px solid var(--border-dark);
  color: var(--text-dark); /* Branco no tema escuro */
}

body[data-theme="light"] th,
body[data-theme="light"] td {
  border-bottom: 1px solid var(--border-light);
  color: var(--text-light);
}

th {
  font-weight: 600;
  color: var(--text-secondary-dark);
  font-size: 15px;
}

body[data-theme="light"] th {
  color: var(--text-secondary-light);
}

td {
  font-size: 15px;
}

tbody tr {
  transition: var(--transition);
}

tbody tr:hover {
  background: var(--border-dark);
}

body[data-theme="light"] tbody tr:hover {
  background: var(--background-light);
}

.badge {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
}

.badge-open { background: rgba(255, 69, 58, 0.2); color: var(--danger-light); }
.badge-progress { background: rgba(255, 159, 10, 0.2); color: var(--warning-light); }
.badge-resolved { background: rgba(48, 209, 88, 0.2); color: var(--success-light); }
.badge-approved { background: rgba(48, 209, 88, 0.2); color: var(--success-light); }
.badge-pending { background: rgba(255, 159, 10, 0.2); color: var(--warning-light); }
.badge-rejected { background: rgba(255, 69, 58, 0.2); color: var(--danger-light); }
.badge-completed { background: rgba(48, 209, 88, 0.2); color: var(--success-light); }
.badge-planned { background: rgba(137, 6, 230, 0.2); color: var(--primary-dark); }

body[data-theme="light"] .badge-planned {
  background: rgba(137, 6, 230, 0.2);
  color: var(--primary-light);
}

.priority-high { border-left: 4px solid var(--danger-light); }
.priority-medium { border-left: 4px solid var(--warning-light); }
.priority-low { border-left: 4px solid var(--success-light); }

.actions {
  display: flex;
  gap: 10px;
}

.btn-icon {
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: 16px;
  color: var(--text-secondary-dark);
  transition: var(--transition);
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

body[data-theme="light"] .btn-icon {
  color: var(--text-secondary-light);
}

.btn-icon:hover {
  background: var(--border-dark);
}

body[data-theme="light"] .btn-icon:hover {
  background: var(--background-light);
}

.btn-edit:hover { color: var(--primary-dark); }
.btn-delete:hover { color: var(--danger-light); }
.btn-view:hover { color: var(--success-light); }

body[data-theme="light"] .btn-edit:hover { color: var(--primary-light); }

.empty-state {
  text-align: center;
  padding: 60px 0;
  color: var(--text-secondary-dark);
}

body[data-theme="light"] .empty-state {
  color: var(--text-secondary-light);
}

.empty-state i {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.5;
}

.empty-state p {
  font-size: 17px;
}

.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(5px);
}

.modal-content {
  background: var(--surface-dark);
  border-radius: var(--border-radius);
  width: 100%;
  max-width: 600px;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
  overflow: hidden;
  max-height: 90vh;
  overflow-y: auto;
}

body[data-theme="light"] .modal-content {
  background: var(--surface-light);
}

.modal-header {
  padding: 24px;
  border-bottom: 1px solid var(--border-dark);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

body[data-theme="light"] .modal-header {
  border-bottom: 1px solid var(--border-light);
}

.modal-header h3 {
  margin: 0;
  color: var(--text-dark); /* Branco no tema escuro */
  font-size: 20px;
  font-weight: 600;
}

body[data-theme="light"] .modal-header h3 {
  color: var(--text-light);
}

.close {
  background: transparent;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--text-secondary-dark);
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
}

body[data-theme="light"] .close {
  color: var(--text-secondary-light);
}

.close:hover {
  background: var(--border-dark);
}

body[data-theme="light"] .close:hover {
  background: var(--background-light);
}

.modal-body {
  padding: 24px;
  color: var(--text-dark); /* Branco no tema escuro */
}

body[data-theme="light"] .modal-body {
  color: var(--text-light);
}

.modal-footer {
  padding: 20px 24px;
  border-top: 1px solid var(--border-dark);
  text-align: right;
}

body[data-theme="light"] .modal-footer {
  border-top: 1px solid var(--border-light);
}

.btn-cancel {
  background: var(--surface-dark);
  color: var(--text-dark); /* Branco no tema escuro */
  border: none;
  padding: 10px 20px;
  border-radius: var(--border-radius);
  cursor: pointer;
  margin-right: 12px;
  font-weight: 500;
  transition: var(--transition);
}

body[data-theme="light"] .btn-cancel {
  background: var(--background-light);
  color: var(--text-light);
}

.btn-cancel:hover {
  background: var(--border-dark);
}

body[data-theme="light"] .btn-cancel:hover {
  background: var(--border-light);
}

.btn-confirm, .btn-danger, .btn-success {
  background: var(--danger-light);
  color: #FFFFFF;
  border: none;
  padding: 10px 20px;
  border-radius: var(--border-radius);
  cursor: pointer;
  font-weight: 500;
  transition: var(--transition);
}

.btn-confirm:hover, .btn-danger:hover {
  background: #D70015;
}

.btn-success {
  background: var(--success-light);
}

.btn-success:hover {
  background: #28A745;
}

.incident-details {
  margin-bottom: 24px;
}

.detail-row {
  display: flex;
  margin-bottom: 16px;
}

.detail-label {
  font-weight: 600;
  min-width: 120px;
  color: var(--text-secondary-dark);
}

body[data-theme="light"] .detail-label {
  color: var(--text-secondary-light);
}

.detail-value {
  flex: 1;
}

.charts-section {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}

.chart-card {
  background: var(--surface-dark);
  border-radius: var(--border-radius);
  padding: 20px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  border: 1px solid var(--border-dark);
  transition: var(--transition);
}

body[data-theme="light"] .chart-card {
  background: var(--surface-light);
  border: 1px solid var(--border-light);
}

.chart-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.chart-header h3 {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-dark); /* Branco no tema escuro */
}

body[data-theme="light"] .chart-header h3 {
  color: var(--text-light);
}

.chart-filter {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid var(--border-dark);
  color: var(--text-dark); /* Branco no tema escuro */
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 12px;
  cursor: pointer;
  transition: var(--transition);
}

body[data-theme="light"] .chart-filter {
  border: 1px solid var(--border-light);
  color: var(--text-light);
}

.chart-filter:hover {
  background: rgba(137, 6, 230, 0.15);
}

.chart-container {
  position: relative;
  height: 220px;
  width: 100%;
}

.chart-container canvas {
  width: 100% !important;
  height: 100% !important;
}

/* Estilização de legendas personalizadas ou texto associado aos gráficos */
.chart-legend {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 10px;
  font-size: 12px;
  color: var(--text-dark); /* Branco no tema escuro */
}

body[data-theme="light"] .chart-legend {
  color: var(--text-secondary-light);
}

.chart-legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
}

.chart-legend-item span {
  width: 12px;
  height: 12px;
  display: inline-block;
  border-radius: 50%;
}

.chart-legend-item span.access {
  background-color: #FF9F0A;
}

.chart-legend-item span.progress {
  background-color: #0A84FF;
}

.chart-legend-item span.resolved {
  background-color: #30D158;
}

.chart-legend-item span.rejected {
  background-color: #FF453A;
}

@media (max-width: 1200px) {
  .charts-section {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 992px) {
  .container {
    flex-direction: column;
  }

  .sidebar {
    width: 100%;
    border-right: none;
    border-bottom: 1px solid var(--border-dark);
  }

  body[data-theme="light"] .sidebar {
    border-bottom: 1px solid var(--border-light);
  }

  .nav-menu {
    display: flex;
    overflow-x: auto;
    padding: 0 12px 12px;
  }

  .nav-item {
    flex-shrink: 0;
  }

  .nav-link {
    padding: 10px 14px;
  }

  .main-content {
    padding: 20px;
  }
}

@media (max-width: 768px) {
  .header {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  .btn-group {
    width: 100%;
    justify-content: space-between;
  }

  .stats-cards,
  .form-row {
    grid-template-columns: 1fr;
  }

  .header h1 {
    font-size: 24px;
  }

  .chart-card {
    padding: 16px;
  }

  .search-box {
    width: 100%;
  }
}

@media (max-width: 576px) {
  .main-content {
    padding: 16px;
  }

  .header h1 {
    font-size: 20px;
  }

  .stat-card {
    flex-direction: column;
    text-align: center;
    padding: 16px;
  }

  .tabs {
    flex-direction: column;
    align-items: flex-start;
  }

  .tab {
    width: 100%;
    text-align: left;
  }

}
  </style>
</head>
<body data-theme="dark">
  <div class="container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="logo1.png" alt="Solution Tecnologia Logo" class="logo">
        <h2></i> Solution Tecnologia</h2>
      </div>

      <div class="user-info">
        <p>Bem-vindo, <strong id="username">Administrador</strong></p>
        <p><span class="role-badge" id="userrole">Administrador</span></p>
      </div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="dashboard-adm.html" class="nav-link">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="itiladm.html" class="nav-link">
            <i class="fas fa-tasks"></i>
            <span>ITIL - Incidentes</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="lgpd-adm.html" class="nav-link active">
            <i class="fas fa-shield-alt"></i>
            <span>LGPD - Requisições</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="network.html" class="nav-link">
            <i class="fas fa-network-wired"></i>
            <span>Monitoramento</span>
          </a>
        </li>
      </ul>
      <div class="sidebar-footer">
        Solution Tecnologia &copy; 2025
      </div>
    </aside>
    <main class="main-content">
      <div class="header">
        <h1><i class="fas fa-shield-alt"></i> LGPD - Gerenciamento</h1>
        <div class="btn-group">
          <a href="dashboard-adm.html" class="back-btn"><i class="fas fa-arrow-left"></i> Voltar</a>
          <button class="theme-toggle" id="theme-toggle"><i class="fas fa-sun"></i></button>
          <button class="logout-btn" onclick="window.location.href='../../login.html'" aria-label="Sair">
            <i class="fas fa-sign-out-alt"></i> Sair
          </button>
        </div>
      </div>
      <div class="tabs">
        <button class="tab active" data-tab="access">Acesso</button>
        <button class="tab" data-tab="deletion">Exclusão</button>
        <button class="tab" data-tab="correction">Correção</button>
        <button class="tab" data-tab="reports">Relatórios</button>
      </div>
      <div class="tab-content active" id="access">
        <div class="stats-cards">
          <div class="stat-card">
            <div class="stat-icon stat-open"><i class="fas fa-exclamation-circle"></i></div>
            <div class="stat-info">
              <h3 id="open-access">6</h3>
              <p>Requisições Abertas</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon stat-progress"><i class="fas fa-spinner"></i></div>
            <div class="stat-info">
              <h3 id="progress-access">4</h3>
              <p>Em Andamento</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon stat-resolved"><i class="fas fa-check-circle"></i></div>
            <div class="stat-info">
              <h3 id="resolved-access">5</h3>
              <p>Aprovadas</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon stat-total"><i class="fas fa-tachometer-alt"></i></div>
            <div class="stat-info">
              <h3 id="total-access">15</h3>
              <p>Total de Requisições</p>
            </div>
          </div>
        </div>
        <div class="charts-section">
          <div class="chart-card">
            <div class="chart-header">
              <h3>Status de Requisições de Acesso</h3>
              <select class="chart-filter" id="access-chart-filter">
                <option value="week">Esta Semana</option>
                <option value="month" selected>Este Mês</option>
                <option value="quarter">Este Trimestre</option>
              </select>
            </div>
            <div class="chart-container">
              <canvas id="access-chart"></canvas>
            </div>
          </div>
        </div>
        <div class="filters-card">
          <div class="filters-header">
            <h3 class="filters-title">Filtros</h3>
            <button class="toggle-filters"><i class="fas fa-filter"></i> Mostrar Filtros</button>
          </div>
          <div class="filters-content" style="display: none;">
            <div class="form-row">
              <div class="filter-group">
                <label for="filter-access-status">Status</label>
                <select id="filter-access-status" class="filter-select">
                  <option value="">Todos</option>
                  <option value="Pendente">Pendente</option>
                  <option value="Em Andamento">Em Andamento</option>
                  <option value="Aprovada">Aprovada</option>
                  <option value="Rejeitada">Rejeitada</option>
                </select>
              </div>
              <div class="filter-group">
                <label for="filter-access-date">Data</label>
                <input type="date" id="filter-access-date" class="filter-input">
              </div>
            </div>
          </div>
        </div>
        <div class="table-card">
          <div class="table-header">
            <h2>Lista de Requisições de Acesso</h2>
            <div class="table-actions">
              <button class="btn-secondary" onclick="refreshAccess()"><i class="fas fa-sync"></i> Atualizar</button>
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-access" placeholder="Pesquisar requisições...">
              </div>
            </div>
          </div>
          <table id="access-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Usuário</th>
                <th>Descrição</th>
                <th>Status</th>
                <th>Data</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div class="tab-content" id="deletion">
        <div class="stats-cards">
          <div class="stat-card">
            <div class="stat-icon stat-open"><i class="fas fa-exclamation-circle"></i></div>
            <div class="stat-info">
              <h3 id="open-deletion">3</h3>
              <p>Requisições Abertas</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon stat-progress"><i class="fas fa-spinner"></i></div>
            <div class="stat-info">
              <h3 id="progress-deletion">2</h3>
              <p>Em Andamento</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon stat-resolved"><i class="fas fa-check-circle"></i></div>
            <div class="stat-info">
              <h3 id="resolved-deletion">4</h3>
              <p>Aprovadas</p>
            </div>
          </div>
        </div>
        <div class="charts-section">
          <div class="chart-card">
            <div class="chart-header">
              <h3>Status de Requisições de Exclusão</h3>
              <select class="chart-filter" id="deletion-chart-filter">
                <option value="week">Esta Semana</option>
                <option value="month" selected>Este Mês</option>
                <option value="quarter">Este Trimestre</option>
              </select>
            </div>
            <div class="chart-container">
              <canvas id="deletion-chart"></canvas>
            </div>
          </div>
        </div>
        <div class="table-card">
          <div class="table-header">
            <h2>Lista de Requisições de Exclusão</h2>
            <div class="table-actions">
              <button class="btn-secondary" onclick="refreshDeletion()"><i class="fas fa-sync"></i> Atualizar</button>
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-deletion" placeholder="Pesquisar requisições...">
              </div>
            </div>
          </div>
          <table id="deletion-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Usuário</th>
                <th>Descrição</th>
                <th>Status</th>
                <th>Data</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div class="tab-content" id="correction">
        <div class="stats-cards">
          <div class="stat-card">
            <div class="stat-icon stat-open"><i class="fas fa-exclamation-circle"></i></div>
            <div class="stat-info">
              <h3 id="open-correction">4</h3>
              <p>Requisições Abertas</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon stat-progress"><i class="fas fa-spinner"></i></div>
            <div class="stat-info">
              <h3 id="progress-correction">3</h3>
              <p>Em Andamento</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon stat-resolved"><i class="fas fa-check-circle"></i></div>
            <div class="stat-info">
              <h3 id="resolved-correction">5</h3>
              <p>Aprovadas</p>
            </div>
          </div>
        </div>
        <div class="charts-section">
          <div class="chart-card">
            <div class="chart-header">
              <h3>Status de Requisições de Correção</h3>
              <select class="chart-filter" id="correction-chart-filter">
                <option value="week">Esta Semana</option>
                <option value="month" selected>Este Mês</option>
                <option value="quarter">Este Trimestre</option>
              </select>
            </div>
            <div class="chart-container">
              <canvas id="correction-chart"></canvas>
            </div>
          </div>
        </div>
        <div class="table-card">
          <div class="table-header">
            <h2>Lista de Requisições de Correção</h2>
            <div class="table-actions">
              <button class="btn-secondary" onclick="refreshCorrection()"><i class="fas fa-sync"></i> Atualizar</button>
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-correction" placeholder="Pesquisar requisições...">
              </div>
            </div>
          </div>
          <table id="correction-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Usuário</th>
                <th>Descrição</th>
                <th>Status</th>
                <th>Data</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div class="tab-content" id="reports">
        <div class="form-card">
          <h2>Gerar Relatório de Conformidade</h2>
          <form id="report-form">
            <div class="form-row">
              <div class="form-group">
                <label for="report-type">Tipo de Relatório</label>
                <select id="report-type" class="form-control" required>
                  <option value="Acesso">Acesso</option>
                  <option value="Exclusão">Exclusão</option>
                  <option value="Correção">Correção</option>
                  <option value="Todos">Todos</option>
                </select>
              </div>
              <div class="form-group">
                <label for="report-period">Período</label>
                <select id="report-period" class="form-control" required>
                  <option value="week">Esta Semana</option>
                  <option value="month">Este Mês</option>
                  <option value="quarter">Este Trimestre</option>
                </select>
              </div>
            </div>
            <button type="submit" class="btn-primary"><i class="fas fa-file-alt"></i> Gerar Relatório</button>
          </form>
        </div>
        <div class="charts-section">
          <div class="chart-card">
            <div class="chart-header">
              <h3>Resumo de Requisições</h3>
              <select class="chart-filter" id="reports-chart-filter">
                <option value="week">Esta Semana</option>
                <option value="month" selected>Este Mês</option>
                <option value="quarter">Este Trimestre</option>
              </select>
            </div>
            <div class="chart-container">
              <canvas id="reports-chart"></canvas>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="request-modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Detalhes da Requisição</h3>
            <button class="close" onclick="closeModal('request-modal')"><i class="fas fa-times"></i></button>
          </div>
          <div class="modal-body">
            <div class="request-details">
              <div class="detail-row"><span class="detail-label">ID:</span><span class="detail-value" id="modal-request-id"></span></div>
              <div class="detail-row"><span class="detail-label">Usuário:</span><span class="detail-value" id="modal-request-user"></span></div>
              <div class="detail-row"><span class="detail-label">Tipo:</span><span class="detail-value" id="modal-request-type"></span></div>
              <div class="detail-row"><span class="detail-label">Descrição:</span><span class="detail-value" id="modal-request-description"></span></div>
              <div class="detail-row"><span class="detail-label">Status:</span><span class="detail-value" id="modal-request-status"></span></div>
              <div class="detail-row"><span class="detail-label">Data:</span><span class="detail-value" id="modal-request-date"></span></div>
            </div>
            <div class="form-group">
              <label for="request-status-update">Atualizar Status</label>
              <select id="request-status-update" class="form-control">
                <option value="Pendente">Pendente</option>
                <option value="Em Andamento">Em Andamento</option>
                <option value="Aprovada">Aprovada</option>
                <option value="Rejeitada">Rejeitada</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-cancel" onclick="closeModal('request-modal')">Fechar</button>
            <button class="btn-success" onclick="approveRequest()">Aprovar</button>
            <button class="btn-danger" onclick="rejectRequest()">Rejeitar</button>
          </div>
        </div>
      </div>
      <div class="modal" id="delete-request-modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Confirmar Exclusão</h3>
            <button class="close" onclick="closeModal('delete-request-modal')"><i class="fas fa-times"></i></button>
          </div>
          <div class="modal-body">
            <p>Tem certeza que deseja excluir esta requisição?</p>
            <p><strong>ID:</strong> <span id="delete-request-id"></span></p>
          </div>
          <div class="modal-footer">
            <button class="btn-cancel" onclick="closeModal('delete-request-modal')">Cancelar</button>
            <button class="btn-danger" onclick="confirmDeleteRequest()">Confirmar</button>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script>
    let accessChart, deletionChart, correctionChart, reportsChart;
    let currentRequestId = null;

    function initializeData() {
      if (!localStorage.getItem('lgpdRequests')) {
        const requests = [
          { id: "LGPD-001", user: "Maria Santos", type: "Acesso", description: "Solicitação de acesso aos dados pessoais", status: "Pendente", date: new Date().toISOString() },
          { id: "LGPD-002", user: "João Oliveira", type: "Exclusão", description: "Solicitação de exclusão de dados", status: "Aprovada", date: new Date().toISOString() },
          { id: "LGPD-003", user: "Ana Costa", type: "Correção", description: "Correção de dados cadastrais", status: "Em Andamento", date: new Date().toISOString() },
          { id: "LGPD-004", user: "Pedro Almeida", type: "Acesso", description: "Acesso a dados de contrato", status: "Pendente", date: new Date(Date.now() - 86400000).toISOString() },
          { id: "LGPD-005", user: "Carla Mendes", type: "Exclusão", description: "Exclusão de histórico", status: "Rejeitada", date: new Date(Date.now() - 172800000).toISOString() },
          { id: "LGPD-006", user: "Roberto Silva", type: "Correção", description: "Atualização de endereço", status: "Aprovada", date: new Date(Date.now() - 259200000).toISOString() },
          { id: "LGPD-007", user: "Fernanda Lima", type: "Acesso", description: "Acesso a dados de pagamento", status: "Em Andamento", date: new Date(Date.now() - 345600000).toISOString() },
          { id: "LGPD-008", user: "Ricardo Souza", type: "Exclusão", description: "Exclusão de conta", status: "Pendente", date: new Date(Date.now() - 432000000).toISOString() },
          { id: "LGPD-009", user: "Patrícia Rocha", type: "Correção", description: "Correção de nome", status: "Pendente", date: new Date(Date.now() - 518400000).toISOString() },
          { id: "LGPD-010", user: "Marcos Ferreira", type: "Acesso", description: "Acesso a histórico de atividades", status: "Aprovada", date: new Date(Date.now() - 604800000).toISOString() },
          { id: "LGPD-011", user: "Juliana Alves", type: "Exclusão", description: "Exclusão de dados de localização", status: "Em Andamento", date: new Date(Date.now() - 691200000).toISOString() },
          { id: "LGPD-012", user: "Gustavo Nunes", type: "Correção", description: "Atualização de telefone", status: "Rejeitada", date: new Date(Date.now() - 777600000).toISOString() },
          { id: "LGPD-013", user: "Luciana Martins", type: "Acesso", description: "Acesso a dados de perfil", status: "Pendente", date: new Date(Date.now() - 864000000).toISOString() },
          { id: "LGPD-014", user: "Daniel Costa", type: "Exclusão", description: "Exclusão de dados de marketing", status: "Aprovada", date: new Date(Date.now() - 950400000).toISOString() },
          { id: "LGPD-015", user: "Sandra Oliveira", type: "Correção", description: "Correção de data de nascimento", status: "Em Andamento", date: new Date(Date.now() - 1036800000).toISOString() }
        ];
        localStorage.setItem('lgpdRequests', JSON.stringify(requests));
      }
    }

    function loadCounts() {
      const requests = JSON.parse(localStorage.getItem('lgpdRequests')) || [];

      // Contagem para Acesso
      const accessRequests = requests.filter(r => r.type === 'Acesso');
      document.getElementById('open-access').textContent = accessRequests.filter(r => r.status === 'Pendente').length;
      document.getElementById('progress-access').textContent = accessRequests.filter(r => r.status === 'Em Andamento').length;
      document.getElementById('resolved-access').textContent = accessRequests.filter(r => r.status === 'Aprovada').length;
      document.getElementById('total-access').textContent = accessRequests.length;

      // Contagem para Exclusão
      const deletionRequests = requests.filter(r => r.type === 'Exclusão');
      document.getElementById('open-deletion').textContent = deletionRequests.filter(r => r.status === 'Pendente').length;
      document.getElementById('progress-deletion').textContent = deletionRequests.filter(r => r.status === 'Em Andamento').length;
      document.getElementById('resolved-deletion').textContent = deletionRequests.filter(r => r.status === 'Aprovada').length;

      // Contagem para Correção
      const correctionRequests = requests.filter(r => r.type === 'Correção');
      document.getElementById('open-correction').textContent = correctionRequests.filter(r => r.status === 'Pendente').length;
      document.getElementById('progress-correction').textContent = correctionRequests.filter(r => r.status === 'Em Andamento').length;
      document.getElementById('resolved-correction').textContent = correctionRequests.filter(r => r.status === 'Aprovada').length;
    }

    function createCharts() {
      const accessCtx = document.getElementById('access-chart')?.getContext('2d');
      const deletionCtx = document.getElementById('deletion-chart')?.getContext('2d');
      const correctionCtx = document.getElementById('correction-chart')?.getContext('2d');
      const reportsCtx = document.getElementById('reports-chart')?.getContext('2d');

      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary-dark'),
              font: { size: 12 },
              padding: 20
            }
          },
          tooltip: {
            callbacks: {
              label: context => `${context.label}: ${context.raw}`
            }
          }
        },
        animation: {
          animateScale: true,
          animateRotate: true
        }
      };

      if (accessCtx) {
        const requests = JSON.parse(localStorage.getItem('lgpdRequests')) || [];
        const accessRequests = requests.filter(r => r.type === 'Acesso');
        
        accessChart = new Chart(accessCtx, {
          type: 'doughnut',
          data: {
            labels: ['Pendente', 'Em Andamento', 'Aprovada', 'Rejeitada'],
            datasets: [{
              data: [
                accessRequests.filter(r => r.status === 'Pendente').length,
                accessRequests.filter(r => r.status === 'Em Andamento').length,
                accessRequests.filter(r => r.status === 'Aprovada').length,
                accessRequests.filter(r => r.status === 'Rejeitada').length
              ],
              backgroundColor: ['#FF9F0A', '#0A84FF', '#30D158', '#FF453A'],
              borderWidth: 0
            }]
          },
          options: chartOptions
        });
      }

      if (deletionCtx) {
        const requests = JSON.parse(localStorage.getItem('lgpdRequests')) || [];
        const deletionRequests = requests.filter(r => r.type === 'Exclusão');
        
        deletionChart = new Chart(deletionCtx, {
          type: 'doughnut',
          data: {
            labels: ['Pendente', 'Em Andamento', 'Aprovada', 'Rejeitada'],
            datasets: [{
              data: [
                deletionRequests.filter(r => r.status === 'Pendente').length,
                deletionRequests.filter(r => r.status === 'Em Andamento').length,
                deletionRequests.filter(r => r.status === 'Aprovada').length,
                deletionRequests.filter(r => r.status === 'Rejeitada').length
              ],
              backgroundColor: ['#FF9F0A', '#0A84FF', '#30D158', '#FF453A'],
              borderWidth: 0
            }]
          },
          options: chartOptions
        });
      }

      if (correctionCtx) {
        const requests = JSON.parse(localStorage.getItem('lgpdRequests')) || [];
        const correctionRequests = requests.filter(r => r.type === 'Correção');
        
        correctionChart = new Chart(correctionCtx, {
          type: 'doughnut',
          data: {
            labels: ['Pendente', 'Em Andamento', 'Aprovada', 'Rejeitada'],
            datasets: [{
              data: [
                correctionRequests.filter(r => r.status === 'Pendente').length,
                correctionRequests.filter(r => r.status === 'Em Andamento').length,
                correctionRequests.filter(r => r.status === 'Aprovada').length,
                correctionRequests.filter(r => r.status === 'Rejeitada').length
              ],
              backgroundColor: ['#FF9F0A', '#0A84FF', '#30D158', '#FF453A'],
              borderWidth: 0
            }]
          },
          options: chartOptions
        });
      }

      if (reportsCtx) {
        const requests = JSON.parse(localStorage.getItem('lgpdRequests')) || [];
        
        reportsChart = new Chart(reportsCtx, {
          type: 'bar',
          data: {
            labels: ['Acesso', 'Exclusão', 'Correção'],
            datasets: [{
              label: 'Requisições',
              data: [
                requests.filter(r => r.type === 'Acesso').length,
                requests.filter(r => r.type === 'Exclusão').length,
                requests.filter(r => r.type === 'Correção').length
              ],
              backgroundColor: '#0A84FF',
              borderRadius: 6
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'top',
                labels: {
                  color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary-dark'),
                  font: { size: 12 },
                  padding: 20
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary-dark') },
                grid: { color: getComputedStyle(document.documentElement).getPropertyValue('--border-dark') }
              },
              x: {
                ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary-dark') },
                grid: { display: false }
              }
            }
          }
        });
      }
    }

    function loadRequests(type) {
      const requests = JSON.parse(localStorage.getItem('lgpdRequests')) || [];
      const filteredRequests = requests.filter(r => r.type === type);
      const tbody = document.querySelector(`#${type.toLowerCase()}-table tbody`);
      if (!tbody) return;

      tbody.innerHTML = '';

      filteredRequests.forEach(request => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${request.id}</td>
          <td>${request.user}</td>
          <td>${request.description.substring(0, 50)}${request.description.length > 50 ? '...' : ''}</td>
          <td><span class="badge badge-${request.status.toLowerCase().replace(' ', '-')}">${request.status}</span></td>
          <td>${new Date(request.date).toLocaleDateString('pt-BR')}</td>
          <td class="actions">
            <button class="btn-icon btn-view" onclick="viewRequest('${request.id}')"><i class="fas fa-eye"></i></button>
            <button class="btn-icon btn-edit" onclick="editRequest('${request.id}')"><i class="fas fa-edit"></i></button>
            <button class="btn-icon btn-delete" onclick="openDeleteRequestModal('${request.id}')"><i class="fas fa-trash"></i></button>
          </td>
        `;
        tbody.appendChild(row);
      });

      if (filteredRequests.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6" class="empty-state"><i class="fas fa-shield-alt"></i><p>Nenhuma requisição encontrada</p></td></tr>`;
      }
    }

    function viewRequest(id) {
      const requests = JSON.parse(localStorage.getItem('lgpdRequests')) || [];
      const request = requests.find(r => r.id === id);
      if (request) {
        document.getElementById('modal-request-id').textContent = request.id;
        document.getElementById('modal-request-user').textContent = request.user;
        document.getElementById('modal-request-type').textContent = request.type;
        document.getElementById('modal-request-description').textContent = request.description;
        document.getElementById('modal-request-status').textContent = request.status;
        document.getElementById('modal-request-date').textContent = new Date(request.date).toLocaleString('pt-BR');
        document.getElementById('request-status-update').value = request.status;
        currentRequestId = request.id;
        openModal('request-modal');
      }
    }

    function editRequest(id) {
      viewRequest(id); // Reutiliza a função viewRequest para preencher o modal
    }

    function updateRequestStatus(status) {
      if (!currentRequestId) return;
      
      const requests = JSON.parse(localStorage.getItem('lgpdRequests')) || [];
      const requestIndex = requests.findIndex(r => r.id === currentRequestId);
      
      if (requestIndex !== -1) {
        requests[requestIndex].status = status;
        localStorage.setItem('lgpdRequests', JSON.stringify(requests));
        
        // Recarregar os dados
        const requestType = requests[requestIndex].type;
        loadRequests(requestType);
        loadCounts();
        createCharts(); // Atualizar os gráficos
        
        closeModal('request-modal');
        alert(`Requisição ${status.toLowerCase()} com sucesso!`);
      }
    }

    function approveRequest() {
      updateRequestStatus('Aprovada');
    }

    function rejectRequest() {
      updateRequestStatus('Rejeitada');
    }

    function openDeleteRequestModal(id) {
      document.getElementById('delete-request-id').textContent = id;
      currentRequestId = id;
      openModal('delete-request-modal');
    }

    function confirmDeleteRequest() {
      if (!currentRequestId) return;
      
      let requests = JSON.parse(localStorage.getItem('lgpdRequests')) || [];
      const request = requests.find(r => r.id === currentRequestId);
      
      if (request) {
        requests = requests.filter(r => r.id !== currentRequestId);
        localStorage.setItem('lgpdRequests', JSON.stringify(requests));
        
        loadRequests(request.type);
        loadCounts();
        createCharts(); // Atualizar os gráficos
        
        closeModal('delete-request-modal');
        alert('Requisição excluída com sucesso!');
      }
    }

    function openModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.style.display = 'flex';
      }
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.style.display = 'none';
      }
      currentRequestId = null;
    }

    function refreshAccess() {
      loadRequests('Acesso');
      alert('Lista de requisições de acesso atualizada!');
    }

    function refreshDeletion() {
      loadRequests('Exclusão');
      alert('Lista de requisições de exclusão atualizada!');
    }

    function refreshCorrection() {
      loadRequests('Correção');
      alert('Lista de requisições de correção atualizada!');
    }

    function searchRequests(type) {
      const searchInput = document.getElementById(`search-${type.toLowerCase()}`);
      if (!searchInput) return;
      
      const searchTerm = searchInput.value.toLowerCase();
      if (!searchTerm) return loadRequests(type);

      const requests = JSON.parse(localStorage.getItem('lgpdRequests')) || [];
      const filteredRequests = requests.filter(r =>
        r.type === type &&
        (r.user.toLowerCase().includes(searchTerm) ||
         r.description.toLowerCase().includes(searchTerm) ||
         r.id.toLowerCase().includes(searchTerm) ||
         r.status.toLowerCase().includes(searchTerm))
      );
      
      const tbody = document.querySelector(`#${type.toLowerCase()}-table tbody`);
      if (!tbody) return;

      tbody.innerHTML = '';

      filteredRequests.forEach(request => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${request.id}</td>
          <td>${request.user}</td>
          <td>${request.description.substring(0, 50)}${request.description.length > 50 ? '...' : ''}</td>
          <td><span class="badge badge-${request.status.toLowerCase().replace(' ', '-')}">${request.status}</span></td>
          <td>${new Date(request.date).toLocaleDateString('pt-BR')}</td>
          <td class="actions">
            <button class="btn-icon btn-view" onclick="viewRequest('${request.id}')"><i class="fas fa-eye"></i></button>
            <button class="btn-icon btn-edit" onclick="editRequest('${request.id}')"><i class="fas fa-edit"></i></button>
            <button class="btn-icon btn-delete" onclick="openDeleteRequestModal('${request.id}')"><i class="fas fa-trash"></i></button>
          </td>
        `;
        tbody.appendChild(row);
      });

      if (filteredRequests.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6" class="empty-state"><i class="fas fa-shield-alt"></i><p>Nenhuma requisição encontrada</p></td></tr>`;
      }
    }

    function updateCharts(filter, chart, type) {
      if (!chart) return;

      // Simulação de dados baseados no filtro selecionado
      let data;
      if (type === 'access' || type === 'deletion' || type === 'correction') {
        if (filter === 'week') {
          data = [4, 3, 3, 1];
        } else if (filter === 'month') {
          data = [6, 4, 5, 2];
        } else {
          data = [8, 6, 7, 3];
        }
        chart.data.datasets[0].data = data;
      } else if (type === 'reports') {
        if (filter === 'week') {
          data = [10, 6, 8];
        } else if (filter === 'month') {
          data = [15, 9, 12];
        } else {
          data = [20, 12, 15];
        }
        chart.data.datasets[0].data = data;
      }
      chart.update();
    }

    function generateReport(e) {
      if (e) e.preventDefault();
      
      const type = document.getElementById('report-type').value;
      const period = document.getElementById('report-period').value;
      const requests = JSON.parse(localStorage.getItem('lgpdRequests')) || [];
      let filteredRequests = requests;

      if (type !== 'Todos') {
        filteredRequests = requests.filter(r => r.type === type);
      }

      const report = {
        type,
        period,
        total: filteredRequests.length,
        pendente: filteredRequests.filter(r => r.status === 'Pendente').length,
        emAndamento: filteredRequests.filter(r => r.status === 'Em Andamento').length,
        aprovada: filteredRequests.filter(r => r.status === 'Aprovada').length,
        rejeitada: filteredRequests.filter(r => r.status === 'Rejeitada').length,
        generatedAt: new Date().toLocaleString('pt-BR')
      };

      alert(`Relatório Gerado!\nTipo: ${report.type}\nPeríodo: ${report.period}\nTotal: ${report.total}\nPendente: ${report.pendente}\nEm Andamento: ${report.emAndamento}\nAprovada: ${report.aprovada}\nRejeitada: ${report.rejeitada}\nGerado em: ${report.generatedAt}`);
    }

    function toggleTheme() {
      const body = document.body;
      const themeToggle = document.getElementById('theme-toggle');
      if (body.dataset.theme === 'dark') {
        body.dataset.theme = 'light';
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        localStorage.setItem('theme', 'light');
      } else {
        body.dataset.theme = 'dark';
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        localStorage.setItem('theme', 'dark');
      }
      
      // Update charts to reflect theme change
      [accessChart, deletionChart, correctionChart, reportsChart].forEach(chart => {
        if (chart) {
          chart.options.plugins.legend.labels.color = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary-dark');
          if (chart.options.scales) {
            if (chart.options.scales.y && chart.options.scales.y.ticks) {
              chart.options.scales.y.ticks.color = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary-dark');
            }
            if (chart.options.scales.x && chart.options.scales.x.ticks) {
              chart.options.scales.x.ticks.color = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary-dark');
            }
            if (chart.options.scales.y && chart.options.scales.y.grid) {
              chart.options.scales.y.grid.color = getComputedStyle(document.documentElement).getPropertyValue('--border-dark');
            }
          }
          chart.update();
        }
      });
    }

    function logout() {
      alert('Você saiu do sistema!');
      // Redirecionar para a página de login
      // window.location.href = 'login.html';
    }

    document.addEventListener('DOMContentLoaded', () => {
      initializeData();
      loadCounts();
      createCharts();
      loadRequests('Acesso');
      loadRequests('Exclusão');
      loadRequests('Correção');

      const theme = localStorage.getItem('theme') || 'dark';
      document.body.dataset.theme = theme;
      document.getElementById('theme-toggle').innerHTML = theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';

      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          tab.classList.add('active');
          const tabContent = document.getElementById(tab.dataset.tab);
          if (tabContent) {
            tabContent.classList.add('active');
          }
        });
      });

      document.getElementById('search-access')?.addEventListener('input', () => searchRequests('Acesso'));
      document.getElementById('search-deletion')?.addEventListener('input', () => searchRequests('Exclusão'));
      document.getElementById('search-correction')?.addEventListener('input', () => searchRequests('Correção'));

      document.querySelector('.toggle-filters')?.addEventListener('click', () => {
        const filtersContent = document.querySelector('.filters-content');
        if (filtersContent) {
          const isVisible = filtersContent.style.display === 'grid';
          filtersContent.style.display = isVisible ? 'none' : 'grid';
          document.querySelector('.toggle-filters').innerHTML = isVisible
            ? '<i class="fas fa-filter"></i> Mostrar Filtros'
            : '<i class="fas fa-filter"></i> Ocultar Filtros';
        }
      });

      document.getElementById('access-chart-filter')?.addEventListener('change', (e) => updateCharts(e.target.value, accessChart, 'access'));
      document.getElementById('deletion-chart-filter')?.addEventListener('change', (e) => updateCharts(e.target.value, deletionChart, 'deletion'));
      document.getElementById('correction-chart-filter')?.addEventListener('change', (e) => updateCharts(e.target.value, correctionChart, 'correction'));
      document.getElementById('reports-chart-filter')?.addEventListener('change', (e) => updateCharts(e.target.value, reportsChart, 'reports'));

      document.getElementById('report-form')?.addEventListener('submit', generateReport);
      document.getElementById('theme-toggle')?.addEventListener('click', toggleTheme);
    });

    // Adicionar event listeners para os filtros de status e data
    document.getElementById('filter-access-status')?.addEventListener('change', () => {
      filterRequests('Acesso');
    });
    
    document.getElementById('filter-access-date')?.addEventListener('change', () => {
      filterRequests('Acesso');
    });

    function filterRequests(type) {
      const statusFilter = document.getElementById(`filter-${type.toLowerCase()}-status`)?.value;
      const dateFilter = document.getElementById(`filter-${type.toLowerCase()}-date`)?.value;
      
      const requests = JSON.parse(localStorage.getItem('lgpdRequests')) || [];
      let filteredRequests = requests.filter(r => r.type === type);

      if (statusFilter) {
        filteredRequests = filteredRequests.filter(r => r.status === statusFilter);
      }
      
      if (dateFilter) {
        const filterDate = new Date(dateFilter);
        filteredRequests = filteredRequests.filter(r => {
          const requestDate = new Date(r.date);
          return requestDate.toDateString() === filterDate.toDateString();
        });
      }

      const tbody = document.querySelector(`#${type.toLowerCase()}-table tbody`);
      if (!tbody) return;

      tbody.innerHTML = '';

      filteredRequests.forEach(request => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${request.id}</td>
          <td>${request.user}</td>
          <td>${request.description.substring(0, 50)}${request.description.length > 50 ? '...' : ''}</td>
          <td><span class="badge badge-${request.status.toLowerCase().replace(' ', '-')}">${request.status}</span></td>
          <td>${new Date(request.date).toLocaleDateString('pt-BR')}</td>
          <td class="actions">
            <button class="btn-icon btn-view" onclick="viewRequest('${request.id}')"><i class="fas fa-eye"></i></button>
            <button class="btn-icon btn-edit" onclick="editRequest('${request.id}')"><i class="fas fa-edit"></i></button>
            <button class="btn-icon btn-delete" onclick="openDeleteRequestModal('${request.id}')"><i class="fas fa-trash"></i></button>
          </td>
        `;
        tbody.appendChild(row);
      });

      if (filteredRequests.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6" class="empty-state"><i class="fas fa-shield-alt"></i><p>Nenhuma requisição encontrada</p></td></tr>`;
      }
    }
  </script>
</body>
</html>